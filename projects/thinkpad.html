<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta property="fb:app_id" content="395776161315353" data-next-head=""/><meta property="og:locale" content="en_GB" data-next-head=""/><meta property="og:site_name" content="I wish I was cool... I wish I was Mike Thomas" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" data-next-head=""/><link rel="manifest" href="/favicon/site.webmanifest" data-next-head=""/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000" data-next-head=""/><link rel="shortcut icon" href="/favicon/favicon.ico" data-next-head=""/><meta name="msapplication-TileColor" content="#000000" data-next-head=""/><meta name="msapplication-config" content="/favicon/browserconfig.xml" data-next-head=""/><meta name="theme-color" content="#000" data-next-head=""/><title data-next-head="">Thinkpads | I wish I was cool... I wish I was Mike Thomas</title><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="The many tinkerings with the internals of an X220 Thinkpad." data-next-head=""/><meta property="og:title" content="Adventures with Thinkpads" data-next-head=""/><meta property="og:description" content="The many tinkerings with the internals of an X220 Thinkpad." data-next-head=""/><meta property="og:url" content="https://www.mikethomas.info/projects/thinkpad" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2017-11-13T00:00:00.000Z" data-next-head=""/><meta property="article:modified_time" content="2025-03-14T23:22:38.962Z" data-next-head=""/><meta property="article:tag" content="Computers" data-next-head=""/><meta property="article:tag" content="Raspberry Pi" data-next-head=""/><meta property="og:image" content="https://www.mikethomas.info/assets/blog/thinkpad/thinkpad-hero.jpg" data-next-head=""/><link rel="canonical" href="https://www.mikethomas.info/projects/thinkpad" data-next-head=""/><meta name="keywords" content="Computers,Lenovo,Thinkpad" data-next-head=""/><script type="application/ld+json" data-next-head="">{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2017-11-13T00:00:00.000Z","description":"The many tinkerings with the internals of an X220 Thinkpad.","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.mikethomas.info/projects/thinkpad"},"headline":"Adventures with Thinkpads","image":["https://www.mikethomas.info/assets/blog/thinkpad/thinkpad-hero.jpg"],"dateModified":"2025-03-14T23:22:38.962Z","author":{"@type":"Person","name":"Mike Thomas"}}</script><link rel="preload" href="/assets/blog/thinkpad/thinkpad-hero.jpg" as="image" data-next-head=""/><link rel="preload" href="/_next/static/chunks/6a5597e8d6bf6454.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/6a5597e8d6bf6454.css" data-n-g=""/><link rel="preload" href="/_next/static/chunks/3ab54434d4227565.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/3ab54434d4227565.css" data-n-g=""/><link rel="preload" href="/_next/static/chunks/42839cc468e789c9.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/42839cc468e789c9.css" data-n-g=""/><link rel="preload" href="/_next/static/chunks/8b6c66e294312134.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/8b6c66e294312134.css" data-n-p=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/6fcfb3b9b61a4877.js" defer=""></script><script src="/_next/static/chunks/0119f7f598da5865.js" defer=""></script><script src="/_next/static/chunks/f9e09d542ba1d189.js" defer=""></script><script src="/_next/static/chunks/b52753283ec5f009.js" defer=""></script><script src="/_next/static/chunks/b72525b216492701.js" defer=""></script><script src="/_next/static/chunks/0daf0721ddf2780f.js" defer=""></script><script src="/_next/static/chunks/turbopack-73e68486d4a20d9c.js" defer=""></script><script src="/_next/static/chunks/5a69ab869cb0af1a.js" defer=""></script><script src="/_next/static/chunks/9f23687a11d5d449.js" defer=""></script><script src="/_next/static/chunks/b69bb7581e994b00.js" defer=""></script><script src="/_next/static/chunks/turbopack-8ff5247e83627486.js" defer=""></script><script src="/_next/static/XDTtabCg-ZBSFSk2yTk__/_ssgManifest.js" defer=""></script><script src="/_next/static/XDTtabCg-ZBSFSk2yTk__/_buildManifest.js" defer=""></script></head><body><div id="__next"><div class="navigation"><a class="navigation-module-scss-module__vECKNW__github-banner github-fork-ribbon d-none d-md-block" href="https://github.com/mikepthomas/projects" target="_blank" rel="noopener noreferrer" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top"><div class="container-fluid"><a href="/" class="navbar-brand"><img class="navigation-module-scss-module__vECKNW__navbar-logo" src="/logo-blue.png" alt="Mike Thomas"/></a><button aria-label="Toggle navigation" type="button" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse"><ul class="mr-auto navbar-nav"><li class="nav-item"><a href="https://github.com/mikepthomas" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github" role="img" viewBox="0 0 512 512" aria-hidden="true"><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM252.8 8c-138.7 0-244.8 105.3-244.8 244 0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1 100-33.2 167.8-128.1 167.8-239 0-138.7-112.5-244-251.2-244zM105.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> <!-- -->GitHub<!-- --> Profile</a></li><li class="nav-item"><a href="https://www.linkedin.com/in/mikepaulthomas" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin" role="img" viewBox="0 0 448 512" aria-hidden="true"><path fill="currentColor" d="M416 32L31.9 32C14.3 32 0 46.5 0 64.3L0 447.7C0 465.5 14.3 480 31.9 480L416 480c17.6 0 32-14.5 32-32.3l0-383.4C448 46.5 433.6 32 416 32zM135.4 416l-66.4 0 0-213.8 66.5 0 0 213.8-.1 0zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77zM384.3 416l-66.4 0 0-104c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9l0 105.8-66.4 0 0-213.8 63.7 0 0 29.2 .9 0c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9l0 117.2z"></path></svg> <!-- -->LinkedIn<!-- --> Profile</a></li><li class="nav-item"><a href="https://instagram.com/montycrabapple" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram" role="img" viewBox="0 0 448 512" aria-hidden="true"><path fill="currentColor" d="M224.3 141a115 115 0 1 0 -.6 230 115 115 0 1 0 .6-230zm-.6 40.4a74.6 74.6 0 1 1 .6 149.2 74.6 74.6 0 1 1 -.6-149.2zm93.4-45.1a26.8 26.8 0 1 1 53.6 0 26.8 26.8 0 1 1 -53.6 0zm129.7 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM399 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg> <!-- -->Instagram<!-- --> Profile</a></li><li class="nav-item"><a href="https://discordapp.com/users/460182324626325535" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord" role="img" viewBox="0 0 576 512" aria-hidden="true"><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1 .1s-.6 .4-.8 .8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2c-41.3 7.1-81.6 19.6-119.7 37.1-.3 .1-.6 .4-.8 .7-76.2 113.8-97.1 224.9-86.9 334.5 0 .3 .1 .5 .2 .8s.3 .4 .5 .6c44.4 32.9 94 58 146.8 74.2 .4 .1 .8 .1 1.1 0s.7-.4 .9-.7c11.3-15.4 21.4-31.8 30-48.8 .1-.2 .2-.5 .2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6 .2-.9 .3-.5 .6-.7c3.1-2.3 6.2-4.7 9.1-7.1 .3-.2 .6-.4 .9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1 .7-.2 1-.2s.7 .2 .9 .4c2.9 2.4 6 4.9 9.1 7.2 .2 .2 .4 .4 .6 .7s.2 .6 .2 .9-.1 .6-.3 .9-.4 .5-.6 .6c-14.7 8.6-30 15.9-45.9 21.8-.2 .1-.5 .2-.7 .4s-.3 .4-.4 .7-.1 .5-.1 .8 .1 .5 .2 .8c8.8 17 18.8 33.3 30 48.8 .2 .3 .6 .6 .9 .7s.8 .1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2 .2-.2 .4-.4 .5-.6s.2-.5 .2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2zm195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2z"></path></svg> <!-- -->Discord<!-- --> Profile</a></li></ul></div></div></nav></div><div class="min-h-screen"><main><nav class="breadcrumbs-module-scss-module__tVmKTG__breadcrumbs position-sticky" aria-label="breadcrumb"><nav class="p-3 bg-light" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/"><svg data-prefix="fas" data-icon="house" class="svg-inline--fa fa-house mr-2" role="img" viewBox="0 0 512 512" aria-hidden="true"><path fill="currentColor" d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272l16 0 0 176c0 35.3 28.7 64 64 64l288 0c35.3 0 64-28.7 64-64l0-176 16 0c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1l-224-208zM240 320l32 0c26.5 0 48 21.5 48 48l0 96-128 0 0-96c0-26.5 21.5-48 48-48z"></path></svg>Home</a></li><li class="breadcrumb-item"><a href="/projects">Projects</a></li><li class="active breadcrumb-item" aria-current="page">Thinkpads</li></ol></nav></nav><div class="container"><article class="mb-16"><div class="mt-24 mb-6 container"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Adventures with Thinkpads</h1></div><div class="mb-6 container"><div class="flex items-center"><img src="/assets/authors/mike.jpg" class="w-12 h-12 rounded-full mr-4" alt="Mike Thomas"/><div class="text-xl font-bold">Mike Thomas</div></div></div><div class="mb-6 container"><svg data-prefix="fas" data-icon="calendar-day" class="svg-inline--fa fa-calendar-day mr-2" role="img" viewBox="0 0 448 512" aria-hidden="true"><path fill="currentColor" d="M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 32 0c35.3 0 64 28.7 64 64l0 288c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 128C0 92.7 28.7 64 64 64l32 0 0-32c0-17.7 14.3-32 32-32zm0 256c-17.7 0-32 14.3-32 32l0 64c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-64c0-17.7-14.3-32-32-32l-64 0z"></path></svg>Created <time dateTime="2017-11-13T00:00:00.000Z">13 November 2017</time>, last modified <time dateTime="2025-03-14T23:22:38.962Z">14 March 2025</time></div><div class="mb-6 container"><span class="mr-2 badge bg-orange rounded-pill">Computers</span><span class="mr-2 badge bg-orange rounded-pill">Raspberry Pi</span></div><div class="mb-6 sm:mx-0 container"><div class="sm:mx-0"><img alt="Cover Image for Adventures with Thinkpads" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/thinkpad-hero.jpg"/></div></div><div class="nav-padding projects-page container"><div class="row"><div class="blog-module-scss-module__trpJnq__markdown col-lg-8"><h2 id="table-of-contents">Table of contents</h2><ol><li><a href="/projects/thinkpad#freenode-live-2017">Freenode Live 2017</a></li><li><a href="/projects/thinkpad#hardware-upgrades">Hardware Upgrades</a><ol><li><a href="/projects/thinkpad#repairs">Repairs</a></li><li><a href="/projects/thinkpad#bluetooth-upgrade">Bluetooth Upgrade</a></li><li><a href="/projects/thinkpad#processor-upgrade">Processor Upgrade</a></li><li><a href="/projects/thinkpad#4g-modem">4G Modem</a></li><li><a href="/projects/thinkpad#solid-state-drives">Solid State Drives</a></li><li><a href="/projects/thinkpad#memory">Memory</a></li></ol></li><li><a href="/projects/thinkpad#the-machines">The Machines</a><ol><li><a href="/projects/thinkpad#x220">X220</a></li><li><a href="/projects/thinkpad#x230">X230</a></li><li><a href="/projects/thinkpad#batteries">Batteries</a></li><li><a href="/projects/thinkpad#spares">Spares</a></li></ol></li><li><a href="/projects/thinkpad#bios-flashing">BIOS Flashing</a><ol><li><a href="/projects/thinkpad#backup-stock-bios">Backup Stock BIOS</a></li><li><a href="/projects/thinkpad#coreboot">Coreboot</a></li><li><a href="/projects/thinkpad#libreboot">Libreboot</a></li></ol></li><li><a href="/projects/thinkpad#operating-systems">Operating Systems</a><ol><li><a href="/projects/thinkpad#chromium-os">Chromium OS</a></li><li><a href="/projects/thinkpad#linux-from-scratch">Linux From Scratch</a></li><li><a href="/projects/thinkpad#mac-os">Mac OS</a></li><li><a href="/projects/thinkpad#ubuntu">Ubuntu</a></li><li><a href="/projects/thinkpad#windows-11">Windows 11</a></li></ol></li></ol><h2 id="freenode-live-2017">Freenode Live 2017</h2><p><span style="opacity:0"><img alt="My Exhibitor Lanyard from Freenode Live" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/freenode-exhibitor.jpg"/></span></p><p>I was a volunteer helping out the <a href="https://www.fsf.org/" rel="noopener noreferrer" target="_blank">Free Software Foundation</a> at Frennode Live 2017 in Bristol, where I got talking to some really interesting people and played on some Thinkpads running entirely Free software. This made me want to build my own.</p><h2 id="hardware-upgrades">Hardware Upgrades</h2><p><span style="opacity:0"><img alt="Parts to upgrade my Thinkpad X220" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/upgrades.jpg"/></span></p><h3 id="repairs">Repairs</h3><p><span style="opacity:0"><img alt="Cracked plastics on a laptop" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/cracked.jpg"/></span></p><p>I brought the laptop for cheap from a seller on eBay. The laptop was quite dirty, has some shiny keys and trackpad and some cracked plastics. my first job was to clean it up and replace the broken parts.</p><p><span style="opacity:0"><img alt="Using Araldite to fix split lid of the laptop" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/repairing-split-lid.jpg"/></span></p><p>I also used Araldite to fix the broken parts where there is a split in the lid of the laptop.</p><h3 id="bluetooth-upgrade">Bluetooth Upgrade</h3><p><span style="opacity:0"><img alt="The Bluetooth module is separate from the Wifi module" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/bluetooth.jpg"/></span></p><p>Bluetooth can be upgraded to Bluetooth 4.0 by simply swapping out the daughter card located under the palm rest.</p><p><span style="opacity:0"><img alt="A Bluetooth 4.0 compatable card salvaged from a broken X230" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/bluetooth-upgrade.jpg"/></span></p><h3 id="processor-upgrade">Processor Upgrade</h3><p><span style="opacity:0"><img alt="The Cables are routed through the keyboard carrier" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/cable-routing.jpg"/></span></p><p>The Laptop came with an Intel i5 processor however the BIOS was locked with a password so I purchased a second hand motherboard with an Intel i7 and swapped the motherboards over.</p><p><span style="opacity:0"><img alt="There are only a few screws holding the motherboard in" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/mainboard-screw-locations.jpg"/></span></p><h3 id="4g-modem">4G Modem</h3><p><span style="opacity:0"><img alt="4G Modem installed in the machine" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/4g-modem.jpg"/></span></p><p>The Laptop came with a 4G modem installed and there is a SIM Card slot in the battery compartment. The module seemed to be locked to the Vodafone network and was quite expensive to use on PAYG.</p><h3 id="solid-state-drives">Solid State Drives</h3><p><span style="opacity:0"><img alt="So good I brought it twice" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/they-are-multiplying.jpg"/></span></p><p>I liked the laptop so much I purchased another one.</p><p><span style="opacity:0"><img alt="A Generic SSD Module" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/generic-ssd.jpg"/></span></p><p>The newer machine came with a small (32GB I believe) generic SSD.</p><p><span style="opacity:0"><img alt="A Crucial SSD Module" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/crucial-ssd.jpg"/></span></p><p>I replaced it with a larger Crucial branded SSD.</p><p><span style="opacity:0"><img alt="A Samsung SSD Module" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/samsung-ssd.jpg"/></span></p><p>And whilst I was at it I replaced the 4G Modem in the other laptop with an SSD too.</p><h3 id="memory">Memory</h3><p>I have now also updated both machines with the maximum that they support. 16GB of Crucial memory in the laptop with a Crucial SSD and 16GB of Samsung memory in the machine with a Samsung SSD.</p><h2 id="the-machines">The Machines</h2><p>I have recently won another Ebay auction for £42.26 that contained 2 X230s and another X220.</p><h3 id="x220">X220</h3><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>CPU</th><th>Case</th><th>Flashed with</th><th>Bluetooth</th><th>Wifi</th><th>Extra</th><th>HDD</th><th>Memory</th></tr></thead><tbody><tr><td>i7-2620M</td><td>Complete, IPS Panel</td><td><a href="https://www.mediafire.com/file/egzdbbm54a5jkqf/X220_v1.46_Modified_BIOS.zip/file" rel="noopener noreferrer" target="_blank">Modified BIOS v1.46</a></td><td>Broadcom 3.0</td><td>Dell DW1510 (For macOS)</td><td>240GB Crucial M500 mSATA SSD</td><td>128GB Crucial MX100 SSD</td><td>16GB Crucial Mac 1600MHz</td></tr><tr><td>i7-2640M</td><td>Complete, IPS Panel</td><td><a href="https://www.mediafire.com/file/egzdbbm54a5jkqf/X220_v1.46_Modified_BIOS.zip/file" rel="noopener noreferrer" target="_blank">Modified BIOS v1.46</a></td><td>Broadcom 4.0</td><td>Intel Centrino Advanced-N 6205</td><td>Ericsson 4G Modem</td><td>256GB Crucial M550 SSD</td><td>16GB Crucial Ballistix Sport 1600MHz</td></tr><tr><td>i5-2520M</td><td>Complete, TN Panel</td><td>Libreboot (Original Stock BIOS v1.31)</td><td>Broadcom 3.0</td><td>Atheros AR5B95 (For Trisquel)</td><td></td><td>320GB Hitachi HDD</td><td>8GB Samsung 1333MHz</td></tr><tr><td>i5-2540M</td><td>Broken IPS Panel, No Webcam</td><td></td><td></td><td></td><td></td><td></td><td>8GB Crucial 1333MHz</td></tr></tbody></table></div><h3 id="x230">X230</h3><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>CPU</th><th>Case</th><th>Flashed with</th><th>Bluetooth</th><th>Wifi</th><th>Extra</th><th>HDD</th><th>Memory</th></tr></thead><tbody><tr><td>i5-3320M</td><td>Complete, TN Panel</td><td>Stock BIOS v2.77</td><td>Broadcom 4.0</td><td>Intel Centrino Advanced-N 6205</td><td></td><td></td><td>8GB Hynix 1600MHz</td></tr><tr><td>i5-3320M</td><td>Complete, TN Panel</td><td>Stock BIOS v2.77</td><td>Broadcom 4.0</td><td>Intel Centrino Advanced-N 6205</td><td></td><td>500GB Seagate SSHD</td><td>4GB Samsung 1600MHz &amp; 4GB Micron 1600MHz</td></tr></tbody></table></div><h3 id="batteries">Batteries</h3><h4 id="big-x220">Big X220</h4><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>Item</th><th>Type</th><th>Full Charge Capacity</th><th>Cycle Count</th></tr></thead><tbody><tr><td>1ZJBF22E2KF</td><td>29++</td><td>10.81 Wh</td><td>329</td></tr><tr><td>1ZJBF24J0L8</td><td>29++</td><td>77.49 Wh</td><td>85</td></tr><tr><td>1ZKFT27R43W</td><td>44++</td><td>68.87 Wh</td><td>511</td></tr></tbody></table></div><h4 id="small-x220">Small X220</h4><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>Item</th><th>Type</th><th>Full Charge Capacity</th><th>Cycle Count</th></tr></thead><tbody><tr><td>1ZJRJ17650D</td><td>29+</td><td>54.75 Wh</td><td>94</td></tr><tr><td>1ZKFS2541BX</td><td>44+</td><td>38.81 Wh</td><td>102</td></tr></tbody></table></div><h4 id="small-x230">Small X230</h4><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>Item</th><th>Type</th><th>Full Charge Capacity</th><th>Cycle Count</th></tr></thead><tbody><tr><td>1ZS1333DB9A</td><td>44+</td><td>53 Wh</td><td>136</td></tr><tr><td>1ZS133AWAP9</td><td>44+</td><td>58.41 Wh</td><td>234</td></tr></tbody></table></div><h3 id="spares">Spares</h3><ul><li>Atheros AR5B95 (For Trisquel)</li><li>Dell DW1510 (For macOS)</li><li>Intel Centrino Advanced-N 6205</li><li>Intel Centrino Wireless-N 1000</li><li>Ericsson 4G Modem</li><li>128GB Samsung mSATA SSD</li><li>128GB Samsung mSATA SSD</li></ul><h2 id="bios-flashing">BIOS Flashing</h2><h3 id="backup-stock-bios">Backup Stock BIOS</h3><p><span style="opacity:0"><img alt="The Stock Thinkpad X220 BIOS screen" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/stock-bios.jpg"/></span></p><p>The stock BIOS screen.</p><p><span style="opacity:0"><img alt="Tools to flash the BIOS chip in the laptop" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/flashing-tools.jpg"/></span></p><p>Collecting the tools required to flash the BIOS:</p><ul><li>A Multimeter</li><li>Some DuPont wires</li><li>A Pomona 5250 clip</li><li>A Raspberry Pi</li></ul><p><span style="opacity:0"><img alt="Connecting a Raspberry Pi to Flash the BIOS" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/raspberry-pi-connection.jpg"/></span></p><h4 id="laptop-pinout">Laptop Pinout</h4><pre class="bg-dark mb-3 p-4 rounded text-light"><code class="code-highlight"><span class="code-line">Screen (furthest from you)
</span><span class="code-line">            __
</span><span class="code-line"> MOSI  5 --|  |-- 4  GND
</span><span class="code-line">  CLK  6 --|  |-- 3  N/C
</span><span class="code-line">  N/C  7 --|  |-- 2  MISO
</span><span class="code-line">  VCC  8 --|__|-- 1  CS
</span><span class="code-line">
</span><span class="code-line">Palm Rest (closest to you)
</span></code></pre><h4 id="pi-pinout">Pi Pinout</h4><pre class="bg-dark mb-3 p-4 rounded text-light"><code class="code-highlight"><span class="code-line">Edge of pi (furthest from you)
</span><span class="code-line">
</span><span class="code-line">L                                                             CS
</span><span class="code-line">E                                                             |
</span><span class="code-line">F +--------------------------------------------------------------------------------------------------------+
</span><span class="code-line">T |    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    |
</span><span class="code-line">  |    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    |
</span><span class="code-line">E +--------------------------------------------^----^----^----^---------------------------------------^----+
</span><span class="code-line">D                                              |    |    |    |                                       |
</span><span class="code-line">G                                             3.3V  MOSI MISO |                                      GND
</span><span class="code-line">E                                           (VCC)            CLK
</span><span class="code-line">
</span><span class="code-line">Body of Pi (closest to you)
</span></code></pre><p>Connecting a Raspberry Pi to read from and write to the BIOS chip.</p><p><span style="opacity:0"><img alt="Backing up the Stock BIOS" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/bios-backup.jpg"/></span></p><p>It&#x27;s always a good idea to read the BIOS data from the chip twice and compare the compare the MD5 hashes to ensure it has been copied correctly.</p><p>One of my X220s had a different brand EEPROM chip than the Winbond one in the screenshot above:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ flashrom <span class="token parameter variable">-p</span> linux_spi:dev<span class="token operator">=</span>/dev/spidev0.0
</span><span class="code-line">flashrom unknown on Linux <span class="token number">6.1</span>.0-rpi8-rpi-v8 <span class="token punctuation">(</span>aarch64<span class="token punctuation">)</span>
</span><span class="code-line">flashrom is <span class="token function">free</span> software, get the <span class="token builtin class-name">source</span> code at https://flashrom.org
</span><span class="code-line">
</span><span class="code-line">Using clock_gettime <span class="token keyword">for</span> delay loops <span class="token punctuation">(</span>clk_id: <span class="token number">1</span>, resolution: 1ns<span class="token punctuation">)</span>.
</span><span class="code-line">Using default 2000kHz clock. Use <span class="token string">&#x27;spispeed&#x27;</span> parameter to override.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6405&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on linux_spi.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6405D&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on linux_spi.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6406E/MX25L6408E&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on linux_spi.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on linux_spi.
</span><span class="code-line">Multiple flash chip definitions match the detected chip<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: <span class="token string">&quot;MX25L6405&quot;</span>, <span class="token string">&quot;MX25L6405D&quot;</span>, <span class="token string">&quot;MX25L6406E/MX25L6408E&quot;</span>, <span class="token string">&quot;MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F&quot;</span>
</span><span class="code-line">Please specify <span class="token function">which</span> chip definition to use with the <span class="token parameter variable">-c</span> <span class="token operator">&lt;</span>chipname<span class="token operator">&gt;</span> option.
</span></code></pre><p>To connect to this chip I had to pass the <code>-c</code> parameter</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ flashrom <span class="token parameter variable">-p</span> linux_spi:dev<span class="token operator">=</span>/dev/spidev0.0 <span class="token parameter variable">-c</span> MX25L6405
</span><span class="code-line">flashrom unknown on Linux <span class="token number">6.1</span>.0-rpi8-rpi-v8 <span class="token punctuation">(</span>aarch64<span class="token punctuation">)</span>
</span><span class="code-line">flashrom is <span class="token function">free</span> software, get the <span class="token builtin class-name">source</span> code at https://flashrom.org
</span><span class="code-line">
</span><span class="code-line">Using clock_gettime <span class="token keyword">for</span> delay loops <span class="token punctuation">(</span>clk_id: <span class="token number">1</span>, resolution: 1ns<span class="token punctuation">)</span>.
</span><span class="code-line">Using default 2000kHz clock. Use <span class="token string">&#x27;spispeed&#x27;</span> parameter to override.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6405&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on linux_spi.
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">This flash part has status UNTESTED <span class="token keyword">for</span> operations: WP
</span><span class="code-line">The <span class="token builtin class-name">test</span> status of this chip may have been updated <span class="token keyword">in</span> the latest development
</span><span class="code-line">version of flashrom. If you are running the latest development version,
</span><span class="code-line">please email a report to flashrom@flashrom.org <span class="token keyword">if</span> any of the above operations
</span><span class="code-line">work correctly <span class="token keyword">for</span> you with this flash chip. Please include the flashrom log
</span><span class="code-line"><span class="token function">file</span> <span class="token keyword">for</span> all operations you tested <span class="token punctuation">(</span>see the <span class="token function">man</span> page <span class="token keyword">for</span> details<span class="token punctuation">)</span>, and mention
</span><span class="code-line"><span class="token function">which</span> mainboard or programmer you tested <span class="token keyword">in</span> the subject line.
</span><span class="code-line">Thanks <span class="token keyword">for</span> your help<span class="token operator">!</span>
</span><span class="code-line">No operations were specified.
</span></code></pre><h3 id="coreboot">Coreboot</h3><p><a href="https://www.coreboot.org/" rel="noopener noreferrer" target="_blank">Coreboot</a> is on Open Source BIOS replacement.</p><p><span style="opacity:0"><img alt="Flashing Coreboot with SeaBIOS Payload" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/bios-flashing.jpg"/></span></p><p>Crossing my fingers and overwriting the stock BIOS.</p><p><span style="opacity:0"><img alt="SeaBIOS running on the laptop" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/seabios.jpg"/></span></p><p>It Works! Running the SeaBIOS Payload using <a href="https://www.coreboot.org/" rel="noopener noreferrer" target="_blank">Coreboot</a>.</p><h3 id="libreboot">Libreboot</h3><p><span style="opacity:0"><img alt="Libreboot running on the laptop" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/libreboot.jpg"/></span></p><p>&quot;<a href="https://libreboot.org/" rel="noopener noreferrer" target="_blank">Libreboot</a> is specifically a coreboot distribution&quot;. It simplifies the install with pre-compiled images and also provides scripts to simplify compillation.</p><p>I used Debian 12 Bookworm to build Libreboot from sources:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ <span class="token function">git</span> clone https://codeberg.org/libreboot/lbmk
</span><span class="code-line highlight-line">$ <span class="token builtin class-name">cd</span> lbmk
</span><span class="code-line highlight-line">$ <span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">&quot;Mike Thomas&quot;</span>
</span><span class="code-line highlight-line">$ <span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email mikepthomas@outlook.com
</span><span class="code-line highlight-line">$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python-is-python3
</span><span class="code-line highlight-line">$ <span class="token function">sudo</span> ./mk dependencies debian
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line highlight-line">$ ./mk <span class="token parameter variable">-b</span> coreboot list
</span></code></pre><h4 id="compiling">Compiling</h4><h5 id="x220-1">X220</h5><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ ./mk <span class="token parameter variable">-b</span> coreboot x220_8mb
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">Created CBFS <span class="token punctuation">(</span>capacity <span class="token operator">=</span> <span class="token number">8191460</span> bytes<span class="token punctuation">)</span>
</span><span class="code-line">    BOOTBLOCK
</span><span class="code-line">    CBFS       cbfs_master_header
</span><span class="code-line">    CBFS       cpu_microcode_blob.bin
</span><span class="code-line">    CBFS       fallback/romstage
</span><span class="code-line">Image SIZE <span class="token number">8388608</span>
</span><span class="code-line">    CBFS       fallback/ramstage
</span><span class="code-line">    CBFS       config
</span><span class="code-line">    CBFS       revision
</span><span class="code-line">    CBFS       build_info
</span><span class="code-line">    CBFS       fallback/dsdt.aml
</span><span class="code-line">    CBFS       vbt.bin
</span><span class="code-line">    CBFS       cmos.default
</span><span class="code-line">    CBFS       cmos_layout.bin
</span><span class="code-line">    CBFS       fallback/postcar
</span><span class="code-line">    DD         Adding Intel Firmware Descriptor
</span><span class="code-line">    IFDTOOL    me.bin -<span class="token operator">&gt;</span> coreboot.pre
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File build/coreboot.pre is <span class="token number">8388608</span> bytes
</span><span class="code-line">File build/me.bin is <span class="token number">86016</span> bytes
</span><span class="code-line">Adding build/me.bin as the Intel ME section of build/coreboot.pre
</span><span class="code-line">Writing new image to build/coreboot.pre
</span><span class="code-line">    IFDTOOL    gbe.bin -<span class="token operator">&gt;</span> coreboot.pre
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File build/coreboot.pre is <span class="token number">8388608</span> bytes
</span><span class="code-line">File <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/config/ifd/xx20/gbe is <span class="token number">8192</span> bytes
</span><span class="code-line">Adding <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/config/ifd/xx20/gbe as the GbE section of build/coreboot.pre
</span><span class="code-line">Writing new image to build/coreboot.pre
</span><span class="code-line">    IFDTOOL    Unlocking Management Engine
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File build/coreboot.pre is <span class="token number">8388608</span> bytes
</span><span class="code-line">Writing new image to build/coreboot.pre
</span><span class="code-line">    CBFS       coreboot.rom
</span><span class="code-line">    CBFSLAYOUT  coreboot.rom
</span><span class="code-line">
</span><span class="code-line">This image contains the following sections that can be manipulated with this tool:
</span><span class="code-line">
</span><span class="code-line"><span class="token string">&#x27;RW_MRC_CACHE&#x27;</span> <span class="token punctuation">(</span>size <span class="token number">65536</span>, offset <span class="token number">131072</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token string">&#x27;COREBOOT&#x27;</span> <span class="token punctuation">(</span>CBFS, size <span class="token number">8191488</span>, offset <span class="token number">197120</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">It is possible to perform either the <span class="token function">write</span> action or the CBFS add/remove actions on every section listed above.
</span><span class="code-line">To see the image<span class="token string">&#x27;s read-only sections as well, rerun with the -w option.
</span></span><span class="code-line"><span class="token string">    CBFSPRINT  coreboot.rom
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">FMAP REGION: COREBOOT
</span></span><span class="code-line"><span class="token string">Name                           Offset     Type           Size   Comp
</span></span><span class="code-line"><span class="token string">cbfs_master_header             0x0        cbfs header        32 none
</span></span><span class="code-line"><span class="token string">cpu_microcode_blob.bin         0x80       microcode       26624 none
</span></span><span class="code-line"><span class="token string">fallback/romstage              0x68c0     stage           90608 none
</span></span><span class="code-line"><span class="token string">fallback/ramstage              0x1cb40    stage          121009 LZMA (257980 decompressed)
</span></span><span class="code-line"><span class="token string">config                         0x3a480    raw              3267 LZMA (10422 decompressed)
</span></span><span class="code-line"><span class="token string">revision                       0x3b180    raw               727 none
</span></span><span class="code-line"><span class="token string">build_info                     0x3b480    raw               110 none
</span></span><span class="code-line"><span class="token string">fallback/dsdt.aml              0x3b540    raw             14765 none
</span></span><span class="code-line"><span class="token string">vbt.bin                        0x3ef40    raw              1400 LZMA (3985 decompressed)
</span></span><span class="code-line"><span class="token string">cmos.default                   0x3f500    cmos_default      256 none
</span></span><span class="code-line"><span class="token string">cmos_layout.bin                0x3f640    cmos_layout      1976 none
</span></span><span class="code-line"><span class="token string">fallback/postcar               0x3fe40    stage           21680 none
</span></span><span class="code-line"><span class="token string">(empty)                        0x45340    null          7887460 none
</span></span><span class="code-line"><span class="token string">bootblock                      0x7cadc0   bootblock       20480 none
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">Built lenovo/x220 (ThinkPad X220)
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">ccache statistics
</span></span><span class="code-line"><span class="token string">Cacheable calls:             759 / 784 (96.81%)
</span></span><span class="code-line"><span class="token string">  Hits:                      753 / 759 (99.21%)
</span></span><span class="code-line"><span class="token string">    Direct:                   80 / 753 (10.62%)
</span></span><span class="code-line"><span class="token string">    Preprocessed:            673 / 753 (89.38%)
</span></span><span class="code-line"><span class="token string">  Misses:                      6 / 759 ( 0.79%)
</span></span><span class="code-line"><span class="token string">Uncacheable calls:            25 / 784 ( 3.19%)
</span></span><span class="code-line"><span class="token string">  Called for linking:         12 /  25 (48.00%)
</span></span><span class="code-line"><span class="token string">  Called for preprocessing:   13 /  25 (52.00%)
</span></span><span class="code-line"><span class="token string">Successful lookups:
</span></span><span class="code-line"><span class="token string">  Direct:                     80 / 759 (10.54%)
</span></span><span class="code-line"><span class="token string">  Preprocessed:              673 / 679 (99.12%)
</span></span><span class="code-line"><span class="token string">Local storage:
</span></span><span class="code-line"><span class="token string">  Hits:                      753 / 759 (99.21%)
</span></span><span class="code-line"><span class="token string">  Misses:                      6 / 759 ( 0.79%)
</span></span><span class="code-line"><span class="token string">  Reads:                    1518
</span></span><span class="code-line"><span class="token string">  Writes:                    685
</span></span><span class="code-line"><span class="token string">make: Leaving directory &#x27;</span>/home/mike/Repos/lbmk/src/coreboot/default<span class="token string">&#x27;
</span></span><span class="code-line"><span class="token string">CONFIG_PAYLOAD_NONE=y
</span></span><span class="code-line"><span class="token string">make: Entering directory &#x27;</span>/home/mike/Repos/lbmk/src/coreboot/default<span class="token string">&#x27;
</span></span><span class="code-line"><span class="token string">make: Leaving directory &#x27;</span>/home/mike/Repos/lbmk/src/coreboot/default&#x27;
</span></code></pre><h5 id="x230-1">X230</h5><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ ./mk <span class="token parameter variable">-b</span> coreboot x230_12mb
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">Created CBFS <span class="token punctuation">(</span>capacity <span class="token operator">=</span> <span class="token number">12385764</span> bytes<span class="token punctuation">)</span>
</span><span class="code-line">    BOOTBLOCK
</span><span class="code-line">    CBFS       cbfs_master_header
</span><span class="code-line">    CBFS       cpu_microcode_blob.bin
</span><span class="code-line">    CBFS       fallback/romstage
</span><span class="code-line">Image SIZE <span class="token number">12582912</span>
</span><span class="code-line">    CBFS       fallback/ramstage
</span><span class="code-line">    CBFS       config
</span><span class="code-line">    CBFS       revision
</span><span class="code-line">    CBFS       build_info
</span><span class="code-line">    CBFS       fallback/dsdt.aml
</span><span class="code-line">    CBFS       vbt.bin
</span><span class="code-line">    CBFS       cmos.default
</span><span class="code-line">    CBFS       cmos_layout.bin
</span><span class="code-line">    CBFS       fallback/postcar
</span><span class="code-line">    DD         Adding Intel Firmware Descriptor
</span><span class="code-line">    IFDTOOL    me.bin -<span class="token operator">&gt;</span> coreboot.pre
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File build/coreboot.pre is <span class="token number">12582912</span> bytes
</span><span class="code-line">File build/me.bin is <span class="token number">98304</span> bytes
</span><span class="code-line">Adding build/me.bin as the Intel ME section of build/coreboot.pre
</span><span class="code-line">Writing new image to build/coreboot.pre
</span><span class="code-line">    IFDTOOL    gbe.bin -<span class="token operator">&gt;</span> coreboot.pre
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File build/coreboot.pre is <span class="token number">12582912</span> bytes
</span><span class="code-line">File <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/config/ifd/xx30/gbe is <span class="token number">8192</span> bytes
</span><span class="code-line">Adding <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/config/ifd/xx30/gbe as the GbE section of build/coreboot.pre
</span><span class="code-line">Writing new image to build/coreboot.pre
</span><span class="code-line">    IFDTOOL    Unlocking Management Engine
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File build/coreboot.pre is <span class="token number">12582912</span> bytes
</span><span class="code-line">Writing new image to build/coreboot.pre
</span><span class="code-line">    CBFS       coreboot.rom
</span><span class="code-line">    CBFSLAYOUT  coreboot.rom
</span><span class="code-line">
</span><span class="code-line">This image contains the following sections that can be manipulated with this tool:
</span><span class="code-line">
</span><span class="code-line"><span class="token string">&#x27;RW_MRC_CACHE&#x27;</span> <span class="token punctuation">(</span>size <span class="token number">65536</span>, offset <span class="token number">131072</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token string">&#x27;COREBOOT&#x27;</span> <span class="token punctuation">(</span>CBFS, size <span class="token number">12385792</span>, offset <span class="token number">197120</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">It is possible to perform either the <span class="token function">write</span> action or the CBFS add/remove actions on every section listed above.
</span><span class="code-line">To see the image<span class="token string">&#x27;s read-only sections as well, rerun with the -w option.
</span></span><span class="code-line"><span class="token string">    CBFSPRINT  coreboot.rom
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">FMAP REGION: COREBOOT
</span></span><span class="code-line"><span class="token string">Name                           Offset     Type           Size   Comp
</span></span><span class="code-line"><span class="token string">cbfs_master_header             0x0        cbfs header        32 none
</span></span><span class="code-line"><span class="token string">cpu_microcode_blob.bin         0x80       microcode       26624 none
</span></span><span class="code-line"><span class="token string">fallback/romstage              0x68c0     stage           87216 none
</span></span><span class="code-line"><span class="token string">fallback/ramstage              0x1be00    stage          118954 LZMA (252084 decompressed)
</span></span><span class="code-line"><span class="token string">config                         0x38f00    raw              3274 LZMA (10428 decompressed)
</span></span><span class="code-line"><span class="token string">revision                       0x39c00    raw               727 none
</span></span><span class="code-line"><span class="token string">build_info                     0x39f00    raw               110 none
</span></span><span class="code-line"><span class="token string">fallback/dsdt.aml              0x39fc0    raw             14765 none
</span></span><span class="code-line"><span class="token string">vbt.bin                        0x3d9c0    raw              1433 LZMA (4281 decompressed)
</span></span><span class="code-line"><span class="token string">cmos.default                   0x3dfc0    cmos_default      256 none
</span></span><span class="code-line"><span class="token string">cmos_layout.bin                0x3e100    cmos_layout      2012 none
</span></span><span class="code-line"><span class="token string">fallback/postcar               0x3e940    stage           21680 none
</span></span><span class="code-line"><span class="token string">(empty)                        0x43e40    null         12087140 none
</span></span><span class="code-line"><span class="token string">bootblock                      0xbcadc0   bootblock       20480 none
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">Built lenovo/x230 (ThinkPad X230)
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">ccache statistics
</span></span><span class="code-line"><span class="token string">Cacheable calls:             759 / 784 (96.81%)
</span></span><span class="code-line"><span class="token string">  Hits:                      758 / 759 (99.87%)
</span></span><span class="code-line"><span class="token string">    Direct:                   80 / 758 (10.55%)
</span></span><span class="code-line"><span class="token string">    Preprocessed:            678 / 758 (89.45%)
</span></span><span class="code-line"><span class="token string">  Misses:                      1 / 759 ( 0.13%)
</span></span><span class="code-line"><span class="token string">Uncacheable calls:            25 / 784 ( 3.19%)
</span></span><span class="code-line"><span class="token string">  Called for linking:         12 /  25 (48.00%)
</span></span><span class="code-line"><span class="token string">  Called for preprocessing:   13 /  25 (52.00%)
</span></span><span class="code-line"><span class="token string">Successful lookups:
</span></span><span class="code-line"><span class="token string">  Direct:                     80 / 759 (10.54%)
</span></span><span class="code-line"><span class="token string">  Preprocessed:              678 / 679 (99.85%)
</span></span><span class="code-line"><span class="token string">Local storage:
</span></span><span class="code-line"><span class="token string">  Hits:                      758 / 759 (99.87%)
</span></span><span class="code-line"><span class="token string">  Misses:                      1 / 759 ( 0.13%)
</span></span><span class="code-line"><span class="token string">  Reads:                    1518
</span></span><span class="code-line"><span class="token string">  Writes:                    680
</span></span><span class="code-line"><span class="token string">make: Leaving directory &#x27;</span>/home/mike/Repos/lbmk/src/coreboot/default<span class="token string">&#x27;
</span></span><span class="code-line"><span class="token string">CONFIG_PAYLOAD_NONE=y
</span></span><span class="code-line"><span class="token string">make: Entering directory &#x27;</span>/home/mike/Repos/lbmk/src/coreboot/default<span class="token string">&#x27;
</span></span><span class="code-line"><span class="token string">make: Leaving directory &#x27;</span>/home/mike/Repos/lbmk/src/coreboot/default&#x27;
</span></code></pre><h4 id="prepare-a-release-image">Prepare a Release image</h4><p>Get the latest release rom from <a href="https://libreboot.org/download.html" rel="noopener noreferrer" target="_blank">a mirror on the Downloads page</a> and verify the sha512 e.g:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ <span class="token function">wget</span> https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz
</span><span class="code-line">--2024-08-28 <span class="token number">15</span>:46:01--  https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz
</span><span class="code-line">Resolving www.mirrorservice.org <span class="token punctuation">(</span>www.mirrorservice.org<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">212.219</span>.56.184, <span class="token number">2001</span>:630:341:12::184
</span><span class="code-line">Connecting to www.mirrorservice.org <span class="token punctuation">(</span>www.mirrorservice.org<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">212.219</span>.56.184<span class="token operator">|</span>:443<span class="token punctuation">..</span>. connected.
</span><span class="code-line">HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
</span><span class="code-line">Length: <span class="token number">3288796</span> <span class="token punctuation">(</span><span class="token number">3</span>.1M<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/x-xz<span class="token punctuation">]</span>
</span><span class="code-line">Saving to: ‘libreboot-20240612_x220_8mb.tar.xz’
</span><span class="code-line">
</span><span class="code-line">libreboot-20240612_x220_8mb.tar.xz                    <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>   <span class="token number">3</span>.14M  <span class="token number">19</span>.6MB/s    <span class="token keyword">in</span> <span class="token number">0</span>.2s
</span><span class="code-line">
</span><span class="code-line"><span class="token number">2024</span>-08-28 <span class="token number">15</span>:46:01 <span class="token punctuation">(</span><span class="token number">19.6</span> MB/s<span class="token punctuation">)</span> - ‘libreboot-20240612_x220_8mb.tar.xz’ saved <span class="token punctuation">[</span><span class="token number">3288796</span>/3288796<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line highlight-line">$ <span class="token function">wget</span> https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz.sha512
</span><span class="code-line">--2024-08-28 <span class="token number">15</span>:46:17--  https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz.sha512
</span><span class="code-line">Resolving www.mirrorservice.org <span class="token punctuation">(</span>www.mirrorservice.org<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">212.219</span>.56.184, <span class="token number">2001</span>:630:341:12::184
</span><span class="code-line">Connecting to www.mirrorservice.org <span class="token punctuation">(</span>www.mirrorservice.org<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">212.219</span>.56.184<span class="token operator">|</span>:443<span class="token punctuation">..</span>. connected.
</span><span class="code-line">HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
</span><span class="code-line">Length: <span class="token number">167</span> <span class="token punctuation">[</span>application/x-xz<span class="token punctuation">]</span>
</span><span class="code-line">Saving to: ‘libreboot-20240612_x220_8mb.tar.xz.sha512’
</span><span class="code-line">
</span><span class="code-line">libreboot-20240612_x220_8mb.tar.xz.sha512             <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>     <span class="token number">167</span>  --.-KB/s    <span class="token keyword">in</span> 0s
</span><span class="code-line">
</span><span class="code-line"><span class="token number">2024</span>-08-28 <span class="token number">15</span>:46:17 <span class="token punctuation">(</span><span class="token number">78.4</span> MB/s<span class="token punctuation">)</span> - ‘libreboot-20240612_x220_8mb.tar.xz.sha512’ saved <span class="token punctuation">[</span><span class="token number">167</span>/167<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line highlight-line">$ sha512sum <span class="token parameter variable">-c</span> libreboot-20240612_x220_8mb.tar.xz.sha512
</span><span class="code-line">./libreboot-20240612_x220_8mb.tar.xz: OK
</span></code></pre><p>Inject the Management Engine into a Release image:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ ./vendor inject libreboot-20240612_x220_8mb.tar.xz
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">File tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom is <span class="token number">8388608</span> bytes
</span><span class="code-line">File vendorfiles/xx20/me.bin is <span class="token number">86016</span> bytes
</span><span class="code-line">Adding vendorfiles/xx20/me.bin as the Intel ME section of tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom
</span><span class="code-line">Writing new image to tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom
</span><span class="code-line">ROM image successfully patched: tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom is <span class="token number">8388608</span> bytes
</span><span class="code-line">File vendorfiles/xx20/me.bin is <span class="token number">86016</span> bytes
</span><span class="code-line">Adding vendorfiles/xx20/me.bin as the Intel ME section of tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom
</span><span class="code-line">Writing new image to tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom
</span><span class="code-line">ROM image successfully patched: tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line"><span class="token punctuation">..</span>.
</span></code></pre><p>Make sure the Management Engine is present before flashing the image:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ ./mk <span class="token parameter variable">-d</span> coreboot x220_8mb
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line highlight-line">$ ./elf/ifdtool/default/ifdtool <span class="token parameter variable">-x</span> bin/release/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom
</span><span class="code-line">Warning: No platform specified. Output may be incomplete
</span><span class="code-line">File bin/release/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom is <span class="token number">8388608</span> bytes
</span><span class="code-line">  Flash Region <span class="token number">0</span> <span class="token punctuation">(</span>Flash Descriptor<span class="token punctuation">)</span>: 00000000 - 00000fff
</span><span class="code-line">  Flash Region <span class="token number">1</span> <span class="token punctuation">(</span>BIOS<span class="token punctuation">)</span>: 00018000 - 007fffff
</span><span class="code-line">  Flash Region <span class="token number">2</span> <span class="token punctuation">(</span>Intel ME<span class="token punctuation">)</span>: 00003000 - 00017fff
</span><span class="code-line">  Flash Region <span class="token number">3</span> <span class="token punctuation">(</span>GbE<span class="token punctuation">)</span>: 00001000 - 00002fff
</span><span class="code-line">  Flash Region <span class="token number">4</span> <span class="token punctuation">(</span>Platform Data<span class="token punctuation">)</span>: 00fff000 - 00000fff <span class="token punctuation">(</span>unused<span class="token punctuation">)</span>
</span><span class="code-line highlight-line">$ hexdump flashregion_2_intel_me.bin
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">0010500 4dde 9bf2 bdc9 79b3 c237 266f 27e6 <span class="token number">9038</span>
</span><span class="code-line">0010510 bb90 c196 249d 012b a19e e27c b042 <span class="token number">3129</span>
</span><span class="code-line">0010520 8b65 b4dc a806 45a9 0cea 70b1 19d3 13d3
</span><span class="code-line">0010530 faf6 9b87 4d63 f761 f7f7 f7f7 f7f7 f7f7
</span><span class="code-line">0010540 f7f7 f7f7 f7f7 f7f7 f7f7 f7f7 fff6 ffff
</span><span class="code-line">0010550 ffff ffff ffff ffff ffff ffff ffff ffff
</span><span class="code-line">*
</span><span class="code-line">0010c80 36ff 7fdf 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f
</span><span class="code-line">0010c90 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f
</span><span class="code-line">*
</span><span class="code-line">0010cc0 7f7f 7f7f 7f7f ff60 ffff ffff ffff ffff
</span><span class="code-line">0010cd0 ffff ffff ffff ffff ffff ffff ffff ffff
</span><span class="code-line">*
</span><span class="code-line">0011160 7fff fe8c 5e5e d058 f80c 0cd0 d0f8 f80c
</span><span class="code-line">0011170 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8
</span><span class="code-line">0011180 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0
</span><span class="code-line">0011190 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c
</span><span class="code-line">00111a0 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8
</span><span class="code-line">00111b0 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0
</span><span class="code-line">00111c0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c
</span><span class="code-line">00111d0 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8
</span><span class="code-line">00111e0 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0
</span><span class="code-line">00111f0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c
</span><span class="code-line">0011200 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 fff8
</span><span class="code-line">0011210 ffff ffff ffff ffff ffff ffff ffff ffff
</span><span class="code-line">*
</span><span class="code-line">0015000
</span></code></pre><h4 id="split-x230-image">Split X230 image</h4><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ <span class="token builtin class-name">cd</span> ./bin/x230_12mb/
</span><span class="code-line highlight-line">$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>seagrub_x230_12mb_libgfxinit_corebootfb_ukqwerty.rom <span class="token assign-left variable">of</span><span class="token operator">=</span>top.rom <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">skip</span><span class="token operator">=</span><span class="token number">8</span>
</span><span class="code-line"><span class="token number">4</span>+0 records <span class="token keyword">in</span>
</span><span class="code-line"><span class="token number">4</span>+0 records out
</span><span class="code-line"><span class="token number">4194304</span> bytes <span class="token punctuation">(</span><span class="token number">4.2</span> MB, <span class="token number">4.0</span> MiB<span class="token punctuation">)</span> copied, <span class="token number">0.0175795</span> s, <span class="token number">239</span> MB/s
</span><span class="code-line highlight-line">$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>seagrub_x230_12mb_libgfxinit_corebootfb_ukqwerty.rom <span class="token assign-left variable">of</span><span class="token operator">=</span>bottom.rom <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">8</span>
</span><span class="code-line"><span class="token number">8</span>+0 records <span class="token keyword">in</span>
</span><span class="code-line"><span class="token number">8</span>+0 records out
</span><span class="code-line"><span class="token number">8388608</span> bytes <span class="token punctuation">(</span><span class="token number">8.4</span> MB, <span class="token number">8.0</span> MiB<span class="token punctuation">)</span> copied, <span class="token number">0.0340301</span> s, <span class="token number">247</span> MB/s
</span></code></pre><h4 id="flashing">Flashing</h4><h5 id="serprog">Serprog</h5><p>You can use a Raspberry Pi Pico to flash the bios, you can compile the image to flash to the pico with one of the following.</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ ./mk <span class="token parameter variable">-b</span> pico-serprog
</span></code></pre><h5 id="flashprog">Flashprog</h5><p>Libreboot standardises on flashprog now, compile it with:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ ./mk <span class="token parameter variable">-b</span> flashprog
</span></code></pre><h6 id="external-flashing">External Flashing</h6><p>Connecting the EEPROM to a Raspberry Pi for flashing is same the same way as <a href="/projects/thinkpad#backup-stock-bios">Backing up the stock BIOS</a>.</p><p>I had an error when erasing and writing the flash chip, however it managed to recover itself:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ flashrom <span class="token parameter variable">-p</span> linux_spi:dev<span class="token operator">=</span>/dev/spidev0.0 <span class="token parameter variable">-c</span> MX25L6405 <span class="token parameter variable">-w</span> ./grub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom
</span><span class="code-line">flashrom unknown on Linux <span class="token number">6.1</span>.0-rpi8-rpi-v8 <span class="token punctuation">(</span>aarch64<span class="token punctuation">)</span>
</span><span class="code-line">flashrom is <span class="token function">free</span> software, get the <span class="token builtin class-name">source</span> code at https://flashrom.org
</span><span class="code-line">
</span><span class="code-line">Using clock_gettime <span class="token keyword">for</span> delay loops <span class="token punctuation">(</span>clk_id: <span class="token number">1</span>, resolution: 1ns<span class="token punctuation">)</span>.
</span><span class="code-line">Using default 2000kHz clock. Use <span class="token string">&#x27;spispeed&#x27;</span> parameter to override.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6405&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on linux_spi.
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">This flash part has status UNTESTED <span class="token keyword">for</span> operations: WP
</span><span class="code-line">The <span class="token builtin class-name">test</span> status of this chip may have been updated <span class="token keyword">in</span> the latest development
</span><span class="code-line">version of flashrom. If you are running the latest development version,
</span><span class="code-line">please email a report to flashrom@flashrom.org <span class="token keyword">if</span> any of the above operations
</span><span class="code-line">work correctly <span class="token keyword">for</span> you with this flash chip. Please include the flashrom log
</span><span class="code-line"><span class="token function">file</span> <span class="token keyword">for</span> all operations you tested <span class="token punctuation">(</span>see the <span class="token function">man</span> page <span class="token keyword">for</span> details<span class="token punctuation">)</span>, and mention
</span><span class="code-line"><span class="token function">which</span> mainboard or programmer you tested <span class="token keyword">in</span> the subject line.
</span><span class="code-line">Thanks <span class="token keyword">for</span> your help<span class="token operator">!</span>
</span><span class="code-line">Reading old flash chip contents<span class="token punctuation">..</span>. done.
</span><span class="code-line">Erasing and writing flash chip<span class="token punctuation">..</span>. FAILED at 0x00081000<span class="token operator">!</span> <span class="token assign-left variable">Expected</span><span class="token operator">=</span>0xff, <span class="token assign-left variable">Found</span><span class="token operator">=</span>0xea, failed byte count from 0x00080000-0x0008ffff: 0xeee7
</span><span class="code-line">ERASE FAILED<span class="token operator">!</span>
</span><span class="code-line">Reading current flash chip contents<span class="token punctuation">..</span>. done. Looking <span class="token keyword">for</span> another erase function.
</span><span class="code-line">Erase/write done.
</span><span class="code-line">Verifying flash<span class="token punctuation">..</span>. VERIFIED.
</span></code></pre><h6 id="internal-flashing">Internal Flashing</h6><p>Once Libreboot is installed, you can flash updates internally without having to take the machine apart again:</p><pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line highlight-line">$ <span class="token function">sudo</span> ./elf/flashprog/flashprog <span class="token parameter variable">-p</span> internal <span class="token parameter variable">-c</span> MX25L6405 <span class="token parameter variable">-w</span> ./bin/x220_8mb/seagrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom
</span><span class="code-line"><span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> user:
</span><span class="code-line">flashprog p1.1-72-ge86b2a0 on Linux <span class="token number">5.15</span>.0-119-generic <span class="token punctuation">(</span>x86_64<span class="token punctuation">)</span>
</span><span class="code-line">flashprog is <span class="token function">free</span> software, get the <span class="token builtin class-name">source</span> code at https://flashprog.org
</span><span class="code-line">
</span><span class="code-line">Using clock_gettime <span class="token keyword">for</span> delay loops <span class="token punctuation">(</span>clk_id: <span class="token number">1</span>, resolution: 1ns<span class="token punctuation">)</span>.
</span><span class="code-line">coreboot table found at 0x7fe68000.
</span><span class="code-line">Found chipset <span class="token string">&quot;Intel QM67&quot;</span><span class="token builtin class-name">.</span>
</span><span class="code-line">Enabling flash write<span class="token punctuation">..</span>. SPI Configuration is locked down.
</span><span class="code-line">OK.
</span><span class="code-line">Found Macronix flash chip <span class="token string">&quot;MX25L6405&quot;</span> <span class="token punctuation">(</span><span class="token number">8192</span> kB, SPI<span class="token punctuation">)</span> on internal.
</span><span class="code-line">Reading old flash chip contents<span class="token punctuation">..</span>. done.
</span><span class="code-line">Erasing and writing flash chip<span class="token punctuation">..</span>. Erase/write done.
</span><span class="code-line">Verifying flash<span class="token punctuation">..</span>. VERIFIED.
</span></code></pre><h2 id="operating-systems">Operating Systems</h2><p>A non-exhaustive list of operating systems that I have used on the laptop.</p><h3 id="chromium-os">Chromium OS</h3><p><span style="opacity:0"><img alt="Chromium OS running on the X220" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/chromium-os.jpg"/></span></p><p>I compilled <a href="https://www.chromium.org/chromium-os/quick-start-guide/" rel="noopener noreferrer" target="_blank">Chromium OS</a> and got it running on the laptop.</p><p><span style="opacity:0"><img alt="I compiled the OS myself from the original source code" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/chromium-os-developer-build.jpg"/></span></p><h3 id="linux-from-scratch">Linux From Scratch</h3><p><span style="opacity:0"><img alt="Linux From Scratch running on the X220" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/linux-from-scratch.jpg"/></span></p><p>I ran through the base <a href="https://www.linuxfromscratch.org/lfs/view/stable/" rel="noopener noreferrer" target="_blank">Linux from Scratch book</a> and got a basic Linux os.</p><h3 id="mac-os">Mac OS</h3><p><span style="opacity:0"><img alt="Mac OS running on the X220" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/mac-os.jpg"/></span></p><p>The laptop can run up to <a href="https://x220.mcdonnelltech.com/" rel="noopener noreferrer" target="_blank">Mac OS High Sierra</a> as the Video card does not support Metal.</p><h3 id="ubuntu">Ubuntu</h3><p><span style="opacity:0"><img alt="Ubuntu running on the X220" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/ubuntu.jpg"/></span></p><p>The Main Operating system I use on the laptop</p><h3 id="windows-11">Windows 11</h3><p><span style="opacity:0"><img alt="Windows 11 running on the X220" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkpad/windows-11.jpg"/></span></p><p>The laptop does not officially support Windows 11 as it does not have Secure boot or a TPM 2.0, it only has a TPM 1.1.</p></div><div class="col-lg-4"><div class="blog-module-scss-module__trpJnq__sidebar position-sticky"><div class="p-4 mb-3 bg-light rounded"><h5>Related Content</h5><ul><li><a href="/projects/thinkcenter">Thinkcenter</a></li></ul><h5>Elsewhere</h5><ul><li><a href="/projects/printer">Anet A8</a></li><li><a href="/projects/printer-rook">Rook 2020</a></li><li><a href="/projects/printer-voron-0.2">Voron 0.2</a></li><li><a href="/projects/printer-voron-1.8">Voron 1.8</a></li><li><a href="/projects/printer-voron-2.4">Voron 2.4</a></li><li><a href="/projects/printer-polyformer">Polyformer</a></li><li><a href="/projects/3d-lab-print-piper-cub">3D LabPrint Piper Cub</a></li><li><a href="/projects/3d-sets-landy">3D Sets Landy</a></li><li><a href="/projects/openrc-f1">OpenRC F1</a></li><li><a href="/projects/openrc-truggy">OpenRC Truggy</a></li><li><a href="/projects/openrc-mini-quad">OpenRC Mini Quad</a></li><li><a href="/projects/knick-knacks">Knick Knacks</a></li><li><a href="/projects/fallout-wasteland-warfare">Fallout: Wasteland Warfare</a></li><li><a href="/projects/guitar">Guitar</a></li><li><a href="/projects/eurorack-modular-synth">Eurorack Modular Synth</a></li><li><a href="/projects/printer-klipper-fan-hat">Klipper Fan Hat</a></li><li><a href="/projects/homelab">Homelab</a></li><li><a href="/projects/cameras">Cameras</a></li><li><a href="/projects/horology">Horology</a></li></ul></div></div></div></div></div></article></div></main></div><div class="container"><footer class="d-flex flex-wrap py-3 border-top text-muted"><div class="d-flex align-items-center col">© 2016-<!-- -->2026<!-- --> Mike Thomas, All rights reserved.</div><div class="d-flex justify-content-end col"><a href="/projects/thinkpad#__next">Back to top</a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"thinkpad","related":["/projects/thinkcenter"],"external":[],"title":"Thinkpads","heading":"Adventures with Thinkpads","date":"2017-11-13T00:00:00.000Z","preview":"/assets/blog/thinkpad/thinkpad-hero.jpg","author":{"name":"Mike Thomas","picture":"/assets/authors/mike.jpg"},"description":"The many tinkerings with the internals of an X220 Thinkpad.","tags":["Computers","Raspberry Pi"],"categories":[],"keywords":["Computers","Lenovo","Thinkpad"],"promoted":false,"content":"\n# Table of contents\n\n# Freenode Live 2017\n\n![My Exhibitor Lanyard from Freenode Live](/assets/blog/thinkpad/freenode-exhibitor.jpg)\n\nI was a volunteer helping out the [Free Software Foundation](https://www.fsf.org/) at Frennode Live 2017 in Bristol, where I got talking to some really interesting people and played on some Thinkpads running entirely Free software. This made me want to build my own.\n\n# Hardware Upgrades\n\n![Parts to upgrade my Thinkpad X220](/assets/blog/thinkpad/upgrades.jpg)\n\n## Repairs\n\n![Cracked plastics on a laptop](/assets/blog/thinkpad/cracked.jpg)\n\nI brought the laptop for cheap from a seller on eBay. The laptop was quite dirty, has some shiny keys and trackpad and some cracked plastics. my first job was to clean it up and replace the broken parts.\n\n![Using Araldite to fix split lid of the laptop](/assets/blog/thinkpad/repairing-split-lid.jpg)\n\nI also used Araldite to fix the broken parts where there is a split in the lid of the laptop.\n\n## Bluetooth Upgrade\n\n![The Bluetooth module is separate from the Wifi module](/assets/blog/thinkpad/bluetooth.jpg)\n\nBluetooth can be upgraded to Bluetooth 4.0 by simply swapping out the daughter card located under the palm rest.\n\n![A Bluetooth 4.0 compatable card salvaged from a broken X230](/assets/blog/thinkpad/bluetooth-upgrade.jpg)\n\n## Processor Upgrade\n\n![The Cables are routed through the keyboard carrier](/assets/blog/thinkpad/cable-routing.jpg)\n\nThe Laptop came with an Intel i5 processor however the BIOS was locked with a password so I purchased a second hand motherboard with an Intel i7 and swapped the motherboards over.\n\n![There are only a few screws holding the motherboard in](/assets/blog/thinkpad/mainboard-screw-locations.jpg)\n\n## 4G Modem\n\n![4G Modem installed in the machine](/assets/blog/thinkpad/4g-modem.jpg)\n\nThe Laptop came with a 4G modem installed and there is a SIM Card slot in the battery compartment. The module seemed to be locked to the Vodafone network and was quite expensive to use on PAYG.\n\n## Solid State Drives\n\n![So good I brought it twice](/assets/blog/thinkpad/they-are-multiplying.jpg)\n\nI liked the laptop so much I purchased another one.\n\n![A Generic SSD Module](/assets/blog/thinkpad/generic-ssd.jpg)\n\nThe newer machine came with a small (32GB I believe) generic SSD.\n\n![A Crucial SSD Module](/assets/blog/thinkpad/crucial-ssd.jpg)\n\nI replaced it with a larger Crucial branded SSD.\n\n![A Samsung SSD Module](/assets/blog/thinkpad/samsung-ssd.jpg)\n\nAnd whilst I was at it I replaced the 4G Modem in the other laptop with an SSD too.\n\n## Memory\n\nI have now also updated both machines with the maximum that they support. 16GB of Crucial memory in the laptop with a Crucial SSD and 16GB of Samsung memory in the machine with a Samsung SSD.\n\n# The Machines\n\nI have recently won another Ebay auction for £42.26 that contained 2 X230s and another X220.\n\n## X220\n\n| CPU      | Case                        | Flashed with                                                                                            | Bluetooth    | Wifi                           | Extra                        | HDD                     | Memory                               |\n| -------- | --------------------------- | ------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------ | ---------------------------- | ----------------------- | ------------------------------------ |\n| i7-2620M | Complete, IPS Panel         | [Modified BIOS v1.46](https://www.mediafire.com/file/egzdbbm54a5jkqf/X220_v1.46_Modified_BIOS.zip/file) | Broadcom 3.0 | Dell DW1510 (For macOS)        | 240GB Crucial M500 mSATA SSD | 128GB Crucial MX100 SSD | 16GB Crucial Mac 1600MHz             |\n| i7-2640M | Complete, IPS Panel         | [Modified BIOS v1.46](https://www.mediafire.com/file/egzdbbm54a5jkqf/X220_v1.46_Modified_BIOS.zip/file) | Broadcom 4.0 | Intel Centrino Advanced-N 6205 | Ericsson 4G Modem            | 256GB Crucial M550 SSD  | 16GB Crucial Ballistix Sport 1600MHz |\n| i5-2520M | Complete, TN Panel          | Libreboot (Original Stock BIOS v1.31)                                                                   | Broadcom 3.0 | Atheros AR5B95 (For Trisquel)  |                              | 320GB Hitachi HDD       | 8GB Samsung 1333MHz                  |\n| i5-2540M | Broken IPS Panel, No Webcam |                                                                                                         |              |                                |                              |                         | 8GB Crucial 1333MHz                  |\n\n## X230\n\n| CPU      | Case               | Flashed with     | Bluetooth    | Wifi                           | Extra | HDD                | Memory                                   |\n| -------- | ------------------ | ---------------- | ------------ | ------------------------------ | ----- | ------------------ | ---------------------------------------- |\n| i5-3320M | Complete, TN Panel | Stock BIOS v2.77 | Broadcom 4.0 | Intel Centrino Advanced-N 6205 |       |                    | 8GB Hynix 1600MHz                        |\n| i5-3320M | Complete, TN Panel | Stock BIOS v2.77 | Broadcom 4.0 | Intel Centrino Advanced-N 6205 |       | 500GB Seagate SSHD | 4GB Samsung 1600MHz \u0026 4GB Micron 1600MHz |\n\n## Batteries\n\n### Big X220\n\n| Item        | Type | Full Charge Capacity | Cycle Count |\n| ----------- | ---- | -------------------- | ----------- |\n| 1ZJBF22E2KF | 29++ | 10.81 Wh             | 329         |\n| 1ZJBF24J0L8 | 29++ | 77.49 Wh             | 85          |\n| 1ZKFT27R43W | 44++ | 68.87 Wh             | 511         |\n\n### Small X220\n\n| Item        | Type | Full Charge Capacity | Cycle Count |\n| ----------- | ---- | -------------------- | ----------- |\n| 1ZJRJ17650D | 29+  | 54.75 Wh             | 94          |\n| 1ZKFS2541BX | 44+  | 38.81 Wh             | 102         |\n\n### Small X230\n\n| Item        | Type | Full Charge Capacity | Cycle Count |\n| ----------- | ---- | -------------------- | ----------- |\n| 1ZS1333DB9A | 44+  | 53 Wh                | 136         |\n| 1ZS133AWAP9 | 44+  | 58.41 Wh             | 234         |\n\n## Spares\n\n- Atheros AR5B95 (For Trisquel)\n- Dell DW1510 (For macOS)\n- Intel Centrino Advanced-N 6205\n- Intel Centrino Wireless-N 1000\n- Ericsson 4G Modem\n- 128GB Samsung mSATA SSD\n- 128GB Samsung mSATA SSD\n\n# BIOS Flashing\n\n## Backup Stock BIOS\n\n![The Stock Thinkpad X220 BIOS screen](/assets/blog/thinkpad/stock-bios.jpg)\n\nThe stock BIOS screen.\n\n![Tools to flash the BIOS chip in the laptop](/assets/blog/thinkpad/flashing-tools.jpg)\n\nCollecting the tools required to flash the BIOS:\n\n- A Multimeter\n- Some DuPont wires\n- A Pomona 5250 clip\n- A Raspberry Pi\n\n![Connecting a Raspberry Pi to Flash the BIOS](/assets/blog/thinkpad/raspberry-pi-connection.jpg)\n\n### Laptop Pinout\n\n```\nScreen (furthest from you)\n            __\n MOSI  5 --|  |-- 4  GND\n  CLK  6 --|  |-- 3  N/C\n  N/C  7 --|  |-- 2  MISO\n  VCC  8 --|__|-- 1  CS\n\nPalm Rest (closest to you)\n```\n\n### Pi Pinout\n\n```\nEdge of pi (furthest from you)\n\nL                                                             CS\nE                                                             |\nF +--------------------------------------------------------------------------------------------------------+\nT |    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    |\n  |    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    |\nE +--------------------------------------------^----^----^----^---------------------------------------^----+\nD                                              |    |    |    |                                       |\nG                                             3.3V  MOSI MISO |                                      GND\nE                                           (VCC)            CLK\n\nBody of Pi (closest to you)\n```\n\nConnecting a Raspberry Pi to read from and write to the BIOS chip.\n\n![Backing up the Stock BIOS](/assets/blog/thinkpad/bios-backup.jpg)\n\nIt's always a good idea to read the BIOS data from the chip twice and compare the compare the MD5 hashes to ensure it has been copied correctly.\n\nOne of my X220s had a different brand EEPROM chip than the Winbond one in the screenshot above:\n\n```bash {1}\n$ flashrom -p linux_spi:dev=/dev/spidev0.0\nflashrom unknown on Linux 6.1.0-rpi8-rpi-v8 (aarch64)\nflashrom is free software, get the source code at https://flashrom.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\nUsing default 2000kHz clock. Use 'spispeed' parameter to override.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on linux_spi.\nFound Macronix flash chip \"MX25L6405D\" (8192 kB, SPI) on linux_spi.\nFound Macronix flash chip \"MX25L6406E/MX25L6408E\" (8192 kB, SPI) on linux_spi.\nFound Macronix flash chip \"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F\" (8192 kB, SPI) on linux_spi.\nMultiple flash chip definitions match the detected chip(s): \"MX25L6405\", \"MX25L6405D\", \"MX25L6406E/MX25L6408E\", \"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F\"\nPlease specify which chip definition to use with the -c \u003cchipname\u003e option.\n```\n\nTo connect to this chip I had to pass the `-c` parameter\n\n```bash {1}\n$ flashrom -p linux_spi:dev=/dev/spidev0.0 -c MX25L6405\nflashrom unknown on Linux 6.1.0-rpi8-rpi-v8 (aarch64)\nflashrom is free software, get the source code at https://flashrom.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\nUsing default 2000kHz clock. Use 'spispeed' parameter to override.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on linux_spi.\n===\nThis flash part has status UNTESTED for operations: WP\nThe test status of this chip may have been updated in the latest development\nversion of flashrom. If you are running the latest development version,\nplease email a report to flashrom@flashrom.org if any of the above operations\nwork correctly for you with this flash chip. Please include the flashrom log\nfile for all operations you tested (see the man page for details), and mention\nwhich mainboard or programmer you tested in the subject line.\nThanks for your help!\nNo operations were specified.\n```\n\n## Coreboot\n\n[Coreboot](https://www.coreboot.org/) is on Open Source BIOS replacement.\n\n![Flashing Coreboot with SeaBIOS Payload](/assets/blog/thinkpad/bios-flashing.jpg)\n\nCrossing my fingers and overwriting the stock BIOS.\n\n![SeaBIOS running on the laptop](/assets/blog/thinkpad/seabios.jpg)\n\nIt Works! Running the SeaBIOS Payload using [Coreboot](https://www.coreboot.org/).\n\n## Libreboot\n\n![Libreboot running on the laptop](/assets/blog/thinkpad/libreboot.jpg)\n\n\"[Libreboot](https://libreboot.org/) is specifically a coreboot distribution\". It simplifies the install with pre-compiled images and also provides scripts to simplify compillation.\n\nI used Debian 12 Bookworm to build Libreboot from sources:\n\n```bash {1-6, 8}\n$ git clone https://codeberg.org/libreboot/lbmk\n$ cd lbmk\n$ git config --global user.name \"Mike Thomas\"\n$ git config --global user.email mikepthomas@outlook.com\n$ sudo apt install python-is-python3\n$ sudo ./mk dependencies debian\n...\n$ ./mk -b coreboot list\n```\n\n### Compiling\n\n#### X220\n\n```bash {1}\n$ ./mk -b coreboot x220_8mb\n...\n...\n...\nCreated CBFS (capacity = 8191460 bytes)\n    BOOTBLOCK\n    CBFS       cbfs_master_header\n    CBFS       cpu_microcode_blob.bin\n    CBFS       fallback/romstage\nImage SIZE 8388608\n    CBFS       fallback/ramstage\n    CBFS       config\n    CBFS       revision\n    CBFS       build_info\n    CBFS       fallback/dsdt.aml\n    CBFS       vbt.bin\n    CBFS       cmos.default\n    CBFS       cmos_layout.bin\n    CBFS       fallback/postcar\n    DD         Adding Intel Firmware Descriptor\n    IFDTOOL    me.bin -\u003e coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 8388608 bytes\nFile build/me.bin is 86016 bytes\nAdding build/me.bin as the Intel ME section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    gbe.bin -\u003e coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 8388608 bytes\nFile ../../../config/ifd/xx20/gbe is 8192 bytes\nAdding ../../../config/ifd/xx20/gbe as the GbE section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    Unlocking Management Engine\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 8388608 bytes\nWriting new image to build/coreboot.pre\n    CBFS       coreboot.rom\n    CBFSLAYOUT  coreboot.rom\n\nThis image contains the following sections that can be manipulated with this tool:\n\n'RW_MRC_CACHE' (size 65536, offset 131072)\n'COREBOOT' (CBFS, size 8191488, offset 197120)\n\nIt is possible to perform either the write action or the CBFS add/remove actions on every section listed above.\nTo see the image's read-only sections as well, rerun with the -w option.\n    CBFSPRINT  coreboot.rom\n\nFMAP REGION: COREBOOT\nName                           Offset     Type           Size   Comp\ncbfs_master_header             0x0        cbfs header        32 none\ncpu_microcode_blob.bin         0x80       microcode       26624 none\nfallback/romstage              0x68c0     stage           90608 none\nfallback/ramstage              0x1cb40    stage          121009 LZMA (257980 decompressed)\nconfig                         0x3a480    raw              3267 LZMA (10422 decompressed)\nrevision                       0x3b180    raw               727 none\nbuild_info                     0x3b480    raw               110 none\nfallback/dsdt.aml              0x3b540    raw             14765 none\nvbt.bin                        0x3ef40    raw              1400 LZMA (3985 decompressed)\ncmos.default                   0x3f500    cmos_default      256 none\ncmos_layout.bin                0x3f640    cmos_layout      1976 none\nfallback/postcar               0x3fe40    stage           21680 none\n(empty)                        0x45340    null          7887460 none\nbootblock                      0x7cadc0   bootblock       20480 none\n\nBuilt lenovo/x220 (ThinkPad X220)\n\nccache statistics\nCacheable calls:             759 / 784 (96.81%)\n  Hits:                      753 / 759 (99.21%)\n    Direct:                   80 / 753 (10.62%)\n    Preprocessed:            673 / 753 (89.38%)\n  Misses:                      6 / 759 ( 0.79%)\nUncacheable calls:            25 / 784 ( 3.19%)\n  Called for linking:         12 /  25 (48.00%)\n  Called for preprocessing:   13 /  25 (52.00%)\nSuccessful lookups:\n  Direct:                     80 / 759 (10.54%)\n  Preprocessed:              673 / 679 (99.12%)\nLocal storage:\n  Hits:                      753 / 759 (99.21%)\n  Misses:                      6 / 759 ( 0.79%)\n  Reads:                    1518\n  Writes:                    685\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\nCONFIG_PAYLOAD_NONE=y\nmake: Entering directory '/home/mike/Repos/lbmk/src/coreboot/default'\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\n```\n\n#### X230\n\n```bash {1}\n$ ./mk -b coreboot x230_12mb\n...\n...\n...\nCreated CBFS (capacity = 12385764 bytes)\n    BOOTBLOCK\n    CBFS       cbfs_master_header\n    CBFS       cpu_microcode_blob.bin\n    CBFS       fallback/romstage\nImage SIZE 12582912\n    CBFS       fallback/ramstage\n    CBFS       config\n    CBFS       revision\n    CBFS       build_info\n    CBFS       fallback/dsdt.aml\n    CBFS       vbt.bin\n    CBFS       cmos.default\n    CBFS       cmos_layout.bin\n    CBFS       fallback/postcar\n    DD         Adding Intel Firmware Descriptor\n    IFDTOOL    me.bin -\u003e coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 12582912 bytes\nFile build/me.bin is 98304 bytes\nAdding build/me.bin as the Intel ME section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    gbe.bin -\u003e coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 12582912 bytes\nFile ../../../config/ifd/xx30/gbe is 8192 bytes\nAdding ../../../config/ifd/xx30/gbe as the GbE section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    Unlocking Management Engine\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 12582912 bytes\nWriting new image to build/coreboot.pre\n    CBFS       coreboot.rom\n    CBFSLAYOUT  coreboot.rom\n\nThis image contains the following sections that can be manipulated with this tool:\n\n'RW_MRC_CACHE' (size 65536, offset 131072)\n'COREBOOT' (CBFS, size 12385792, offset 197120)\n\nIt is possible to perform either the write action or the CBFS add/remove actions on every section listed above.\nTo see the image's read-only sections as well, rerun with the -w option.\n    CBFSPRINT  coreboot.rom\n\nFMAP REGION: COREBOOT\nName                           Offset     Type           Size   Comp\ncbfs_master_header             0x0        cbfs header        32 none\ncpu_microcode_blob.bin         0x80       microcode       26624 none\nfallback/romstage              0x68c0     stage           87216 none\nfallback/ramstage              0x1be00    stage          118954 LZMA (252084 decompressed)\nconfig                         0x38f00    raw              3274 LZMA (10428 decompressed)\nrevision                       0x39c00    raw               727 none\nbuild_info                     0x39f00    raw               110 none\nfallback/dsdt.aml              0x39fc0    raw             14765 none\nvbt.bin                        0x3d9c0    raw              1433 LZMA (4281 decompressed)\ncmos.default                   0x3dfc0    cmos_default      256 none\ncmos_layout.bin                0x3e100    cmos_layout      2012 none\nfallback/postcar               0x3e940    stage           21680 none\n(empty)                        0x43e40    null         12087140 none\nbootblock                      0xbcadc0   bootblock       20480 none\n\nBuilt lenovo/x230 (ThinkPad X230)\n\nccache statistics\nCacheable calls:             759 / 784 (96.81%)\n  Hits:                      758 / 759 (99.87%)\n    Direct:                   80 / 758 (10.55%)\n    Preprocessed:            678 / 758 (89.45%)\n  Misses:                      1 / 759 ( 0.13%)\nUncacheable calls:            25 / 784 ( 3.19%)\n  Called for linking:         12 /  25 (48.00%)\n  Called for preprocessing:   13 /  25 (52.00%)\nSuccessful lookups:\n  Direct:                     80 / 759 (10.54%)\n  Preprocessed:              678 / 679 (99.85%)\nLocal storage:\n  Hits:                      758 / 759 (99.87%)\n  Misses:                      1 / 759 ( 0.13%)\n  Reads:                    1518\n  Writes:                    680\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\nCONFIG_PAYLOAD_NONE=y\nmake: Entering directory '/home/mike/Repos/lbmk/src/coreboot/default'\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\n```\n\n### Prepare a Release image\n\nGet the latest release rom from [a mirror on the Downloads page](https://libreboot.org/download.html) and verify the sha512 e.g:\n\n```bash {1, 13, 25}\n$ wget https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz\n--2024-08-28 15:46:01--  https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz\nResolving www.mirrorservice.org (www.mirrorservice.org)... 212.219.56.184, 2001:630:341:12::184\nConnecting to www.mirrorservice.org (www.mirrorservice.org)|212.219.56.184|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3288796 (3.1M) [application/x-xz]\nSaving to: ‘libreboot-20240612_x220_8mb.tar.xz’\n\nlibreboot-20240612_x220_8mb.tar.xz                    100%[=======================================================================================================================\u003e]   3.14M  19.6MB/s    in 0.2s\n\n2024-08-28 15:46:01 (19.6 MB/s) - ‘libreboot-20240612_x220_8mb.tar.xz’ saved [3288796/3288796]\n\n$ wget https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz.sha512\n--2024-08-28 15:46:17--  https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz.sha512\nResolving www.mirrorservice.org (www.mirrorservice.org)... 212.219.56.184, 2001:630:341:12::184\nConnecting to www.mirrorservice.org (www.mirrorservice.org)|212.219.56.184|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 167 [application/x-xz]\nSaving to: ‘libreboot-20240612_x220_8mb.tar.xz.sha512’\n\nlibreboot-20240612_x220_8mb.tar.xz.sha512             100%[=======================================================================================================================\u003e]     167  --.-KB/s    in 0s\n\n2024-08-28 15:46:17 (78.4 MB/s) - ‘libreboot-20240612_x220_8mb.tar.xz.sha512’ saved [167/167]\n\n$ sha512sum -c libreboot-20240612_x220_8mb.tar.xz.sha512\n./libreboot-20240612_x220_8mb.tar.xz: OK\n```\n\nInject the Management Engine into a Release image:\n\n```bash {1}\n$ ./vendor inject libreboot-20240612_x220_8mb.tar.xz\n...\nFile tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom is 8388608 bytes\nFile vendorfiles/xx20/me.bin is 86016 bytes\nAdding vendorfiles/xx20/me.bin as the Intel ME section of tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nWriting new image to tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nROM image successfully patched: tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nWarning: No platform specified. Output may be incomplete\nFile tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom is 8388608 bytes\nFile vendorfiles/xx20/me.bin is 86016 bytes\nAdding vendorfiles/xx20/me.bin as the Intel ME section of tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nWriting new image to tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nROM image successfully patched: tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nWarning: No platform specified. Output may be incomplete\n...\n```\n\nMake sure the Management Engine is present before flashing the image:\n\n```bash {1, 3, 11}\n$ ./mk -d coreboot x220_8mb\n...\n$ ./elf/ifdtool/default/ifdtool -x bin/release/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nWarning: No platform specified. Output may be incomplete\nFile bin/release/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom is 8388608 bytes\n  Flash Region 0 (Flash Descriptor): 00000000 - 00000fff\n  Flash Region 1 (BIOS): 00018000 - 007fffff\n  Flash Region 2 (Intel ME): 00003000 - 00017fff\n  Flash Region 3 (GbE): 00001000 - 00002fff\n  Flash Region 4 (Platform Data): 00fff000 - 00000fff (unused)\n$ hexdump flashregion_2_intel_me.bin\n...\n0010500 4dde 9bf2 bdc9 79b3 c237 266f 27e6 9038\n0010510 bb90 c196 249d 012b a19e e27c b042 3129\n0010520 8b65 b4dc a806 45a9 0cea 70b1 19d3 13d3\n0010530 faf6 9b87 4d63 f761 f7f7 f7f7 f7f7 f7f7\n0010540 f7f7 f7f7 f7f7 f7f7 f7f7 f7f7 fff6 ffff\n0010550 ffff ffff ffff ffff ffff ffff ffff ffff\n*\n0010c80 36ff 7fdf 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f\n0010c90 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f\n*\n0010cc0 7f7f 7f7f 7f7f ff60 ffff ffff ffff ffff\n0010cd0 ffff ffff ffff ffff ffff ffff ffff ffff\n*\n0011160 7fff fe8c 5e5e d058 f80c 0cd0 d0f8 f80c\n0011170 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8\n0011180 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0\n0011190 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c\n00111a0 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8\n00111b0 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0\n00111c0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c\n00111d0 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8\n00111e0 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0\n00111f0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c\n0011200 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 fff8\n0011210 ffff ffff ffff ffff ffff ffff ffff ffff\n*\n0015000\n```\n\n### Split X230 image\n\n```bash {1-2, 6}\n$ cd ./bin/x230_12mb/\n$ dd if=seagrub_x230_12mb_libgfxinit_corebootfb_ukqwerty.rom of=top.rom bs=1M skip=8\n4+0 records in\n4+0 records out\n4194304 bytes (4.2 MB, 4.0 MiB) copied, 0.0175795 s, 239 MB/s\n$ dd if=seagrub_x230_12mb_libgfxinit_corebootfb_ukqwerty.rom of=bottom.rom bs=1M count=8\n8+0 records in\n8+0 records out\n8388608 bytes (8.4 MB, 8.0 MiB) copied, 0.0340301 s, 247 MB/s\n```\n\n### Flashing\n\n#### Serprog\n\nYou can use a Raspberry Pi Pico to flash the bios, you can compile the image to flash to the pico with one of the following.\n\n```bash {1}\n$ ./mk -b pico-serprog\n```\n\n#### Flashprog\n\nLibreboot standardises on flashprog now, compile it with:\n\n```bash {1}\n$ ./mk -b flashprog\n```\n\n##### External Flashing\n\nConnecting the EEPROM to a Raspberry Pi for flashing is same the same way as [Backing up the stock BIOS](#backup-stock-bios).\n\nI had an error when erasing and writing the flash chip, however it managed to recover itself:\n\n```bash {1}\n$ flashrom -p linux_spi:dev=/dev/spidev0.0 -c MX25L6405 -w ./grub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nflashrom unknown on Linux 6.1.0-rpi8-rpi-v8 (aarch64)\nflashrom is free software, get the source code at https://flashrom.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\nUsing default 2000kHz clock. Use 'spispeed' parameter to override.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on linux_spi.\n===\nThis flash part has status UNTESTED for operations: WP\nThe test status of this chip may have been updated in the latest development\nversion of flashrom. If you are running the latest development version,\nplease email a report to flashrom@flashrom.org if any of the above operations\nwork correctly for you with this flash chip. Please include the flashrom log\nfile for all operations you tested (see the man page for details), and mention\nwhich mainboard or programmer you tested in the subject line.\nThanks for your help!\nReading old flash chip contents... done.\nErasing and writing flash chip... FAILED at 0x00081000! Expected=0xff, Found=0xea, failed byte count from 0x00080000-0x0008ffff: 0xeee7\nERASE FAILED!\nReading current flash chip contents... done. Looking for another erase function.\nErase/write done.\nVerifying flash... VERIFIED.\n```\n\n##### Internal Flashing\n\nOnce Libreboot is installed, you can flash updates internally without having to take the machine apart again:\n\n```bash {1}\n$ sudo ./elf/flashprog/flashprog -p internal -c MX25L6405 -w ./bin/x220_8mb/seagrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\n[sudo] password for user:\nflashprog p1.1-72-ge86b2a0 on Linux 5.15.0-119-generic (x86_64)\nflashprog is free software, get the source code at https://flashprog.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\ncoreboot table found at 0x7fe68000.\nFound chipset \"Intel QM67\".\nEnabling flash write... SPI Configuration is locked down.\nOK.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on internal.\nReading old flash chip contents... done.\nErasing and writing flash chip... Erase/write done.\nVerifying flash... VERIFIED.\n```\n\n# Operating Systems\n\nA non-exhaustive list of operating systems that I have used on the laptop.\n\n## Chromium OS\n\n![Chromium OS running on the X220](/assets/blog/thinkpad/chromium-os.jpg)\n\nI compilled [Chromium OS](https://www.chromium.org/chromium-os/quick-start-guide/) and got it running on the laptop.\n\n![I compiled the OS myself from the original source code](/assets/blog/thinkpad/chromium-os-developer-build.jpg)\n\n## Linux From Scratch\n\n![Linux From Scratch running on the X220](/assets/blog/thinkpad/linux-from-scratch.jpg)\n\nI ran through the base [Linux from Scratch book](https://www.linuxfromscratch.org/lfs/view/stable/) and got a basic Linux os.\n\n## Mac OS\n\n![Mac OS running on the X220](/assets/blog/thinkpad/mac-os.jpg)\n\nThe laptop can run up to [Mac OS High Sierra](https://x220.mcdonnelltech.com/) as the Video card does not support Metal.\n\n## Ubuntu\n\n![Ubuntu running on the X220](/assets/blog/thinkpad/ubuntu.jpg)\n\nThe Main Operating system I use on the laptop\n\n## Windows 11\n\n![Windows 11 running on the X220](/assets/blog/thinkpad/windows-11.jpg)\n\nThe laptop does not officially support Windows 11 as it does not have Secure boot or a TPM 2.0, it only has a TPM 1.1.\n","lastmod":"2025-03-14T23:22:38.962Z"},"related":[{"slug":"thinkcenter","related":[],"external":[],"title":"Thinkcenter","heading":"","date":"","preview":"/assets/blog/thinkcenter/thinkcenter-hero.jpg","author":{"name":"","picture":""},"description":"","tags":[],"categories":[],"keywords":[],"promoted":false,"content":""}]},"__N_SSG":true},"page":"/projects/[slug]","query":{"slug":"thinkpad"},"buildId":"XDTtabCg-ZBSFSk2yTk__","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>