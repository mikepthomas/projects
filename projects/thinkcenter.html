<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta property="fb:app_id" content="395776161315353" data-next-head=""/><meta property="og:locale" content="en_GB" data-next-head=""/><meta property="og:site_name" content="I wish I was cool... I wish I was Mike Thomas" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" data-next-head=""/><link rel="manifest" href="/favicon/site.webmanifest" data-next-head=""/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000" data-next-head=""/><link rel="shortcut icon" href="/favicon/favicon.ico" data-next-head=""/><meta name="msapplication-TileColor" content="#000000" data-next-head=""/><meta name="msapplication-config" content="/favicon/browserconfig.xml" data-next-head=""/><meta name="theme-color" content="#000" data-next-head=""/><title data-next-head="">Thinkcenter | I wish I was cool... I wish I was Mike Thomas</title><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Making old outdated machines do modern things." data-next-head=""/><meta property="og:title" content="Getting small machines to create a Proxmox cluster" data-next-head=""/><meta property="og:description" content="Making old outdated machines do modern things." data-next-head=""/><meta property="og:url" content="https://www.mikethomas.info/projects/thinkcenter" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2025-03-14T23:22:38.962Z" data-next-head=""/><meta property="article:modified_time" content="2025-08-28T16:41:34.471Z" data-next-head=""/><meta property="article:tag" content="Computers" data-next-head=""/><meta property="og:image" content="https://www.mikethomas.info/assets/blog/thinkcenter/thinkcenter-hero.jpg" data-next-head=""/><link rel="canonical" href="https://www.mikethomas.info/projects/thinkcenter" data-next-head=""/><meta name="keywords" content="Computers,Lenovo,Thinkcenter" data-next-head=""/><script type="application/ld+json" data-next-head="">{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2025-03-14T23:22:38.962Z","description":"Making old outdated machines do modern things.","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.mikethomas.info/projects/thinkcenter"},"headline":"Getting small machines to create a Proxmox cluster","image":["https://www.mikethomas.info/assets/blog/thinkcenter/thinkcenter-hero.jpg"],"dateModified":"2025-08-28T16:41:34.471Z","author":{"@type":"Person","name":"Mike Thomas"}}</script><link rel="preload" href="/assets/blog/thinkcenter/thinkcenter-hero.jpg" as="image" data-next-head=""/><link rel="preload" href="/_next/static/css/c6f92de8e742614c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c6f92de8e742614c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/393b0371505a9873.css" as="style"/><link rel="stylesheet" href="/_next/static/css/393b0371505a9873.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-a339f4a57035852b.js" defer=""></script><script src="/_next/static/chunks/framework-a6e0b7e30f98059a.js" defer=""></script><script src="/_next/static/chunks/main-a612c2988afed858.js" defer=""></script><script src="/_next/static/chunks/pages/_app-30e2974eb524b097.js" defer=""></script><script src="/_next/static/chunks/3614f49b-f41f0efde8a71c1f.js" defer=""></script><script src="/_next/static/chunks/04ce947b-4d20b65e4c63866a.js" defer=""></script><script src="/_next/static/chunks/982-f9815873e706e292.js" defer=""></script><script src="/_next/static/chunks/485-7196188b3ce17bec.js" defer=""></script><script src="/_next/static/chunks/pages/projects/%5Bslug%5D-0128a563287ec87a.js" defer=""></script><script src="/_next/static/Y5mSgE8YhqnLmiRs80-DT/_buildManifest.js" defer=""></script><script src="/_next/static/Y5mSgE8YhqnLmiRs80-DT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="navigation"><a class="navigation_github-banner__Smckk github-fork-ribbon d-none d-md-block" href="https://github.com/mikepthomas/projects" target="_blank" rel="noopener noreferrer" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top"><div class="container-fluid"><a href="/" class="navbar-brand"><img class="navigation_navbar-logo__YrC5F" src="/logo-blue.png" alt="Mike Thomas"/></a><button aria-label="Toggle navigation" type="button" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse"><ul class="mr-auto navbar-nav"><li class="nav-item"><a href="https://github.com/mikepthomas" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github" role="img" viewBox="0 0 512 512" aria-hidden="true"><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM252.8 8c-138.7 0-244.8 105.3-244.8 244 0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1 100-33.2 167.8-128.1 167.8-239 0-138.7-112.5-244-251.2-244zM105.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> <!-- -->GitHub<!-- --> Profile</a></li><li class="nav-item"><a href="https://www.linkedin.com/in/mikepaulthomas" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin" role="img" viewBox="0 0 448 512" aria-hidden="true"><path fill="currentColor" d="M416 32L31.9 32C14.3 32 0 46.5 0 64.3L0 447.7C0 465.5 14.3 480 31.9 480L416 480c17.6 0 32-14.5 32-32.3l0-383.4C448 46.5 433.6 32 416 32zM135.4 416l-66.4 0 0-213.8 66.5 0 0 213.8-.1 0zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77zM384.3 416l-66.4 0 0-104c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9l0 105.8-66.4 0 0-213.8 63.7 0 0 29.2 .9 0c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9l0 117.2z"></path></svg> <!-- -->LinkedIn<!-- --> Profile</a></li><li class="nav-item"><a href="https://instagram.com/montycrabapple" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram" role="img" viewBox="0 0 448 512" aria-hidden="true"><path fill="currentColor" d="M224.3 141a115 115 0 1 0 -.6 230 115 115 0 1 0 .6-230zm-.6 40.4a74.6 74.6 0 1 1 .6 149.2 74.6 74.6 0 1 1 -.6-149.2zm93.4-45.1a26.8 26.8 0 1 1 53.6 0 26.8 26.8 0 1 1 -53.6 0zm129.7 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM399 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg> <!-- -->Instagram<!-- --> Profile</a></li><li class="nav-item"><a href="https://discordapp.com/users/460182324626325535" target="_blank" class="nav-link"><svg data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord" role="img" viewBox="0 0 576 512" aria-hidden="true"><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1 .1s-.6 .4-.8 .8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2c-41.3 7.1-81.6 19.6-119.7 37.1-.3 .1-.6 .4-.8 .7-76.2 113.8-97.1 224.9-86.9 334.5 0 .3 .1 .5 .2 .8s.3 .4 .5 .6c44.4 32.9 94 58 146.8 74.2 .4 .1 .8 .1 1.1 0s.7-.4 .9-.7c11.3-15.4 21.4-31.8 30-48.8 .1-.2 .2-.5 .2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6 .2-.9 .3-.5 .6-.7c3.1-2.3 6.2-4.7 9.1-7.1 .3-.2 .6-.4 .9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1 .7-.2 1-.2s.7 .2 .9 .4c2.9 2.4 6 4.9 9.1 7.2 .2 .2 .4 .4 .6 .7s.2 .6 .2 .9-.1 .6-.3 .9-.4 .5-.6 .6c-14.7 8.6-30 15.9-45.9 21.8-.2 .1-.5 .2-.7 .4s-.3 .4-.4 .7-.1 .5-.1 .8 .1 .5 .2 .8c8.8 17 18.8 33.3 30 48.8 .2 .3 .6 .6 .9 .7s.8 .1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2 .2-.2 .4-.4 .5-.6s.2-.5 .2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2zm195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2z"></path></svg> <!-- -->Discord<!-- --> Profile</a></li></ul></div></div></nav></div><div class="min-h-screen"><main><nav class="breadcrumbs_breadcrumbs__p9HFN position-sticky" aria-label="breadcrumb"><nav class="p-3 bg-light" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/"><svg data-prefix="fas" data-icon="house" class="svg-inline--fa fa-house mr-2" role="img" viewBox="0 0 512 512" aria-hidden="true"><path fill="currentColor" d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272l16 0 0 176c0 35.3 28.7 64 64 64l288 0c35.3 0 64-28.7 64-64l0-176 16 0c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1l-224-208zM240 320l32 0c26.5 0 48 21.5 48 48l0 96-128 0 0-96c0-26.5 21.5-48 48-48z"></path></svg>Home</a></li><li class="breadcrumb-item"><a href="/projects">Projects</a></li><li class="active breadcrumb-item" aria-current="page">Thinkcenter</li></ol></nav></nav><div class="container"><article class="mb-16"><div class="mt-24 mb-6 container"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Getting small machines to create a Proxmox cluster</h1></div><div class="mb-6 container"><div class="flex items-center"><img src="/assets/authors/mike.jpg" class="w-12 h-12 rounded-full mr-4" alt="Mike Thomas"/><div class="text-xl font-bold">Mike Thomas</div></div></div><div class="mb-6 container"><svg data-prefix="fas" data-icon="calendar-day" class="svg-inline--fa fa-calendar-day mr-2" role="img" viewBox="0 0 448 512" aria-hidden="true"><path fill="currentColor" d="M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 32 0c35.3 0 64 28.7 64 64l0 288c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 128C0 92.7 28.7 64 64 64l32 0 0-32c0-17.7 14.3-32 32-32zm0 256c-17.7 0-32 14.3-32 32l0 64c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-64c0-17.7-14.3-32-32-32l-64 0z"></path></svg>Created <time dateTime="2025-03-14T23:22:38.962Z">14 March 2025</time>, last modified <time dateTime="2025-08-28T16:41:34.471Z">28 August 2025</time></div><div class="mb-6 container"><span class="mr-2 badge bg-orange rounded-pill">Computers</span></div><div class="mb-6 sm:mx-0 container"><div class="sm:mx-0"><img alt="Cover Image for Getting small machines to create a Proxmox cluster" width="1280" height="960" decoding="async" data-nimg="1" class="img-fluid img-thumbnail" style="color:transparent" src="/assets/blog/thinkcenter/thinkcenter-hero.jpg"/></div></div><div class="nav-padding projects-page container"><div class="row"><div class="blog_markdown__sabr0 col-lg-8"><h2 id="table-of-contents">Table of contents</h2><ol><li><a href="/projects/thinkcenter#intro">Intro</a></li><li><a href="/projects/thinkcenter#the-machines">The Machines</a><ol><li><a href="/projects/thinkcenter#small-form-factor">Small Form Factor</a></li><li><a href="/projects/thinkcenter#tiny-1l">Tiny 1L</a></li></ol></li><li><a href="/projects/thinkcenter#sonatype-nexus-repository">Sonatype Nexus Repository</a><ol><li><a href="/projects/thinkcenter#download-nexus-and-install-to-srv">Download Nexus and Install to <code>/srv</code></a></li><li><a href="/projects/thinkcenter#update-config">Update Config</a></li><li><a href="/projects/thinkcenter#install-as-service">Install As Service</a></li><li><a href="/projects/thinkcenter#nexus-frontend">Nexus Frontend</a></li></ol></li><li><a href="/projects/thinkcenter#proxmox-virtual-environment-ve">Proxmox Virtual Environment (VE)</a><ol><li><a href="/projects/thinkcenter#proxmox-ve-post-install-script">Proxmox VE Post Install Script</a></li><li><a href="/projects/thinkcenter#update-apt-repositories">Update APT Repositories</a></li><li><a href="/projects/thinkcenter#install-useful-tools">Install Useful tools</a></li><li><a href="/projects/thinkcenter#microcode">Microcode</a></li><li><a href="/projects/thinkcenter#sensors">Sensors</a></li><li><a href="/projects/thinkcenter#update-container-images">Update Container images</a></li><li><a href="/projects/thinkcenter#hdmi-audio-crackling-fix">HDMI audio crackling fix</a></li><li><a href="/projects/thinkcenter#pcie-passthrough">PCI(e) Passthrough</a></li></ol></li><li><a href="/projects/thinkcenter#proxmox-backup-server-bs">Proxmox Backup Server (BS)</a><ol><li><a href="/projects/thinkcenter#proxmox-bs-post-install-script">Proxmox BS Post Install Script</a></li><li><a href="/projects/thinkcenter#create-datastore">Create Datastore</a></li></ol></li><li><a href="/projects/thinkcenter#setup-virtual-environment-nodes">Setup Virtual Environment Nodes</a><ol><li><a href="/projects/thinkcenter#setup-network">Setup Network</a></li><li><a href="/projects/thinkcenter#add-resource-mappings">Add Resource Mappings</a></li><li><a href="/projects/thinkcenter#connect-to-grafana">Connect to Grafana</a></li><li><a href="/projects/thinkcenter#add-remote-storage">Add Remote Storage</a></li></ol></li></ol><h2 id="intro">Intro</h2><p>My first Thinkcenter was bought to replace my old “Shed Server” an old HP 3ghz pentium 4 pc with 1gb of ram that I rescued from e-waste from work.</p><p>I upgraded it with a 320GB Western digital raptor drive and installed a student edition of windows server 2008 to run my website via IIS before I used to host it on GitHub Pages.</p><p>It was affectionately called the “Shed Server” as it was installed in my garden shed and connected to the internet via WiFi in my flat whilst I was in University.</p><p>It was likely due to this, why it eventually went to <a href="https://www.youtube.com/watch?v=lm6YnAqPv4w" rel="noopener noreferrer" target="_blank">Silicon Heaven</a>, probably due to the extreme changes in temperature, humidity or by being a home to many a spider.</p><p>The replacement for &quot;Shed Server&quot; was named &quot;Lenny&quot; (just because it is a Lenovo) and going forward my Proxmox cluster name of Thinkcenter Tinys has inherited the Monika.</p><h2 id="the-machines">The Machines</h2><h3 id="small-form-factor">Small Form Factor</h3><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>CPU</th><th>Case</th><th>Flashed with</th><th>Bluetooth</th><th>Wifi</th><th>Extra</th><th>HDD</th><th>Memory</th><th>Notes</th></tr></thead><tbody><tr><td>Core2Duo-6600</td><td>A55 9638</td><td>Windows Server 2008</td><td></td><td>TP-Link Wireless-N PCI Adapter</td><td></td><td>320GB WD Raptor 3.5&quot;</td><td>4GB Samsung 666MHz</td><td></td></tr></tbody></table></div><h3 id="tiny-1l">Tiny 1L</h3><h4 id="router">Router</h4><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>CPU</th><th>Case</th><th>Flashed with</th><th>Bluetooth</th><th>Wifi</th><th>Extra</th><th>NVME SDD</th><th>Memory</th><th>Notes</th></tr></thead><tbody><tr><td>i5-8500T</td><td>M720Q</td><td><a href="https://www.proxmox.com/" rel="noopener noreferrer" target="_blank">Proxmox VE (8.4.11)</a></td><td></td><td></td><td>256GB Sandisk 2.5&quot; SATA SSD &amp; Intel PRO I350 Quad Port Gigabit Ethernet</td><td>512GB Micron 3400 M.2 NVME SSD</td><td>16GB Ramaxel 2666MHz</td><td>With Lenovo VESA Mount to mount to wall</td></tr></tbody></table></div><div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p>This machine will not be part of the main Proxmox cluster but will replace my main router with a OPNsense VM, and will also host VMs for <a href="https://www.proxmox.com/en/about/company-details/press-releases/proxmox-datacenter-manager-alpha" rel="noopener noreferrer" target="_blank">Proxmox Datacenter Manager</a> and <a href="https://www.sonatype.com/products/nexus-community-edition-download" rel="noopener noreferrer" target="_blank">Sonatype Nexus Repository Community Edition</a></p></div><h4 id="proxmox-cluster">Proxmox Cluster</h4><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>CPU</th><th>Case</th><th>Flashed with</th><th>Bluetooth</th><th>Wifi</th><th>Extra</th><th>NVME SDD</th><th>Memory</th><th>Notes</th></tr></thead><tbody><tr><td>i5-8500T</td><td>M720Q</td><td><a href="https://www.proxmox.com/" rel="noopener noreferrer" target="_blank">Proxmox VE (8.4.11)</a></td><td>Intel Bluetooth wireless</td><td>Intel Wireless 8265, No Antenna</td><td>256GB Sandisk 2.5&quot; SATA SSD &amp; Intel PRO I350 Quad Port Gigabit Ethernet</td><td>1TB Crucial P3 Plus M.2 NVME SSD</td><td>32GB Hypertec 2400MHz</td><td>Will be installed in <a href="/projects/homelab#rack">10&quot; Rack</a></td></tr><tr><td>i5-8500T</td><td>M720Q</td><td><a href="https://www.proxmox.com/" rel="noopener noreferrer" target="_blank">Proxmox VE (8.4.11)</a></td><td>Intel Bluetooth wireless</td><td>Intel Wireless 8265, No Antenna</td><td>256GB Samsung 2.5&quot; SATA SSD</td><td>1TB Crucial P3 Plus M.2 NVME SSD</td><td>32GB Hypertec 2400MHz</td><td>Will be installed in <a href="/projects/homelab#rack">10&quot; Rack</a></td></tr><tr><td>i5-8500T</td><td>M720Q</td><td><a href="https://www.proxmox.com/" rel="noopener noreferrer" target="_blank">Proxmox VE (8.4.11)</a></td><td>Intel Bluetooth wireless</td><td>Intel Wireless 8265, No Antenna</td><td>256GB Samsung 2.5&quot; SATA SSD</td><td>1TB Crucial P3 Plus M.2 NVME SSD</td><td>32GB Hypertec 2400MHz</td><td>Will be installed in <a href="/projects/homelab#rack">10&quot; Rack</a></td></tr></tbody></table></div><h4 id="desktops">Desktops</h4><div class="table-responsive"><table class="table table-sm table-bordered table-striped table-hover"><thead><tr><th>CPU</th><th>Case</th><th>Flashed with</th><th>Bluetooth</th><th>Wifi</th><th>Extra</th><th>NVME SDD</th><th>Memory</th><th>Notes</th></tr></thead><tbody><tr><td>i5-8400T</td><td>M720Q</td><td>Windows 11 Pro 64</td><td></td><td></td><td>256GB Micron 1300 2.5&quot; SATA SSD</td><td></td><td>16GB Micron 2133MHz</td><td></td></tr><tr><td>i5-8400T</td><td>M720Q</td><td>Windows 11 Pro 64</td><td>Intel Bluetooth wireless</td><td>Intel Wireless 8265</td><td>256GB Micron 1300 2.5&quot; SATA SSD</td><td></td><td>16GB Micron 2666MHz</td><td></td></tr><tr><td>i5-9400T</td><td>M720Q</td><td>Windows 11 Pro 64</td><td></td><td></td><td>256GB Micron 1300 2.5&quot; SATA SSD</td><td></td><td>16GB SK Hynix 2666MHz</td><td></td></tr><tr><td>i5-9400T</td><td>M720Q</td><td>Windows 11 Pro 64</td><td>Intel Bluetooth wireless</td><td>Intel Wireless 8265</td><td>256GB Micron 1300 2.5&quot; SATA SSD</td><td></td><td>16GB SK Hynix 2666MHz</td><td></td></tr><tr><td>i7-7700T</td><td>M710Q</td><td><a href="https://www.proxmox.com/" rel="noopener noreferrer" target="_blank">Proxmox VE (9.0.5)</a></td><td>Intel Bluetooth wireless</td><td>Intel Dual Band Wireless-AC 3165</td><td>1TB WD Black 2.5&quot; SATA HDD</td><td>256GB WD Black M.2 NVME SSD</td><td>16GB SK Hynix 2400MHz</td><td>Currently using to test upgrade to Proxmox 9 with Debian Trixie</td></tr></tbody></table></div><h2 id="sonatype-nexus-repository">Sonatype Nexus Repository</h2><p>As most of the Operating Systems I use are based upon Debian I have chosen to install Nexus to host APT proxies for the main Debian repositories so that updates will only be downloaded once and each machine can then retrieve the local copy from Nexus rather than having to re-download the updates from the internet.</p><h3 id="download-nexus-and-install-to-srv">Download Nexus and Install to <code>/srv</code></h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">cd</span> Downloads/
</span><span class="code-line"><span class="token function">wget</span> https://download.sonatype.com/nexus/3/nexus-3.83.1-03-linux-x86_64.tar.gz
</span><span class="code-line"><span class="token function">tar</span> xvf nexus-3.83.1-03-linux-x86_64.tar.gz
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">mv</span> nexus-3.83.1-03 /srv
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">mv</span> sonatype-work/ /srv
</span><span class="code-line"><span class="token function">sudo</span> adduser nexus <span class="token parameter variable">--system</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> nexus:nogroup /srv/nexus-3.83.1-03/
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> nexus:nogroup /srv/sonatype-work/
</span></code></pre><h3 id="update-config">Update Config</h3><p>Add the following to <code>/srv/nexus-3.83.1-03/bin/nexus.rc</code>:</p><pre class="language-ini"><code class="language-ini code-highlight"><span class="code-line"><span class="token key attr-name">run_as_user</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">nexus</span>&quot;</span>
</span></code></pre><p>Add the following to <code>/srv/nexus-3.83.1-03/bin/nexus.vmoptions</code>:</p><pre class="language-ini"><code class="language-ini code-highlight"><span class="code-line"><span class="token comment"># Updated Memory Size</span>
</span><span class="code-line">  -Xms1200m
</span><span class="code-line">  -Xmx1200m
</span><span class="code-line">  <span class="token key attr-name">-XX:MaxDirectMemorySize</span><span class="token punctuation">=</span><span class="token value attr-value">2G</span>
</span><span class="code-line"><span class="token comment"># Added User Root to fix file permissions error on nexus boot</span>
</span><span class="code-line"><span class="token key attr-name">-Djava.util.prefs.userRoot</span><span class="token punctuation">=</span><span class="token value attr-value">../sonatype-work/nexus3/javaprefs</span>
</span></code></pre><h3 id="install-as-service">Install As Service</h3><p>Create a symbolic link to the binary of the latest Nexus version:</p><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /srv/nexus-3.83.1-03/bin/nexus /etc/init.d/nexus
</span></code></pre><p>Create the file <code>/etc/systemd/system/nexus.service</code> with the content:</p><pre class="language-ini"><code class="language-ini code-highlight"><span class="code-line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
</span><span class="code-line"><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">nexus service</span>
</span><span class="code-line"><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
</span><span class="code-line"><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">forking</span>
</span><span class="code-line"><span class="token key attr-name">LimitNOFILE</span><span class="token punctuation">=</span><span class="token value attr-value">65536</span>
</span><span class="code-line"><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/init.d/nexus start</span>
</span><span class="code-line"><span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/init.d/nexus stop</span>
</span><span class="code-line"><span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">nexus</span>
</span><span class="code-line"><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">on-abort</span>
</span><span class="code-line"><span class="token key attr-name">TimeoutSec</span><span class="token punctuation">=</span><span class="token value attr-value">600</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
</span><span class="code-line"><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</span></code></pre><p>Enable and start the service and check the logs:</p><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">sudo</span> systemctl daemon-reload
</span><span class="code-line"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> nexus.service
</span><span class="code-line"><span class="token function">sudo</span> systemctl start nexus.service
</span><span class="code-line">journalctl <span class="token parameter variable">-xeu</span> nexus.service
</span><span class="code-line"><span class="token function">tail</span> <span class="token parameter variable">-f</span> /srv/sonatype-work/nexus3/log/nexus.log
</span><span class="code-line"><span class="token function">cat</span> /srv/sonatype-work/nexus3/log/nexus.log <span class="token operator">|</span> <span class="token function">grep</span> ERROR
</span><span class="code-line"><span class="token function">cat</span> /srv/sonatype-work/nexus3/log/nexus.log <span class="token operator">|</span> <span class="token function">grep</span> WARN
</span></code></pre><h3 id="nexus-frontend">Nexus Frontend</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">cat</span> /opt/sonatype-work/nexus3/admin.password
</span></code></pre><ul><li>Visit <a href="http://localhost:8081/" rel="noopener noreferrer" target="_blank">http://localhost:8081/</a></li><li>Change Admin Password</li><li>Add APT Proxies<ul><li><a href="https://packages.adoptium.net/artifactory/deb" rel="noopener noreferrer" target="_blank">adoptium</a></li><li><a href="http://deb.debian.org/debian/" rel="noopener noreferrer" target="_blank">debian</a></li><li><a href="http://security.debian.org/debian-security/" rel="noopener noreferrer" target="_blank">debian-security</a></li><li><a href="https://download.docker.com/linux/debian" rel="noopener noreferrer" target="_blank">docker-debian</a></li><li><a href="https://download.docker.com/linux/raspbian" rel="noopener noreferrer" target="_blank">docker-raspbian</a></li><li><a href="https://packages.mozilla.org/apt" rel="noopener noreferrer" target="_blank">mozilla</a></li><li><a href="https://openmediavault.github.io/packages/" rel="noopener noreferrer" target="_blank">openmediavault-packages</a></li><li><a href="http://packages.openmediavault.org/public/" rel="noopener noreferrer" target="_blank">openmediavault-public</a></li><li><a href="https://packages.pi-top.com/pi-top-os/debian/" rel="noopener noreferrer" target="_blank">pi-top-os</a></li><li><a href="http://download.proxmox.com/debian/pbs" rel="noopener noreferrer" target="_blank">proxmox-bs</a></li><li><a href="http://download.proxmox.com/debian/pdm" rel="noopener noreferrer" target="_blank">proxmox-dm</a></li><li><a href="http://download.proxmox.com/debian/pve" rel="noopener noreferrer" target="_blank">proxmox-ve</a></li><li><a href="http://raspbian.raspberrypi.org/raspbian/" rel="noopener noreferrer" target="_blank">raspbian</a></li><li><a href="http://archive.raspberrypi.com/debian/" rel="noopener noreferrer" target="_blank">raspi</a></li></ul></li></ul><h2 id="proxmox-virtual-environment-ve">Proxmox Virtual Environment (VE)</h2><p>Each of the nodes that I want to run Proxmox on will be set up with the following config.</p><h3 id="proxmox-ve-post-install-script">Proxmox VE Post Install Script</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/post-pve-install.sh<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/scaling-governor.sh<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/microcode.sh<span class="token variable">)</span></span>&quot;</span>
</span></code></pre><h3 id="update-apt-repositories">Update APT Repositories</h3><p>One of the first things I do when setting up a new machine is to update apt to use the Nexus repository we set up in the last section.</p><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">nano</span> /etc/apt/auth.conf.d/nexus.mikethomas.info.conf
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/ceph.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/pve-enterprise.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/pbs-enterprise.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/pve-install-repo.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/pbs-install-repo.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/pvetest-for-beta.list
</span><span class="code-line"><span class="token function">nano</span> /etc/apt/sources.list.d/pbstest-for-beta.list
</span></code></pre><h3 id="install-useful-tools">Install Useful tools</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">apt</span> update
</span><span class="code-line"><span class="token function">apt</span> <span class="token function">install</span> avahi-daemon <span class="token function">htop</span> net-tools
</span><span class="code-line">systemctl status avahi-daemon
</span><span class="code-line"><span class="token function">htop</span>
</span><span class="code-line"><span class="token function">ifconfig</span>
</span></code></pre><h3 id="microcode">Microcode</h3><h4 id="amd">AMD</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">apt</span> list <span class="token parameter variable">--installed</span> <span class="token operator">|</span> <span class="token function">grep</span> microcode
</span><span class="code-line"><span class="token function">apt</span> <span class="token function">install</span> amd64-microcode
</span><span class="code-line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> microcode
</span></code></pre><h4 id="intel">Intel</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">apt</span> list <span class="token parameter variable">--installed</span> <span class="token operator">|</span> <span class="token function">grep</span> microcode
</span><span class="code-line"><span class="token function">apt</span> <span class="token function">install</span> intel-microcode
</span><span class="code-line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> microcode
</span></code></pre><h3 id="sensors">Sensors</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">apt</span> <span class="token function">install</span> lm-sensors
</span><span class="code-line">modprobe nct6683 <span class="token assign-left variable">force</span><span class="token operator">=</span>on
</span><span class="code-line">sensors
</span></code></pre><h3 id="update-container-images">Update Container images</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">pveam update
</span></code></pre><h3 id="hdmi-audio-crackling-fix">HDMI audio crackling fix</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;options snd-hda-intel enable_msi=1&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/snd-hda-intel.conf
</span></code></pre><h3 id="pcie-passthrough">PCI(e) Passthrough</h3><h4 id="verify-iommu-is-enabled">Verify IOMMU is enabled</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-e</span> AMD <span class="token parameter variable">-e</span> DMAR <span class="token parameter variable">-e</span> IOMMU
</span></code></pre><p>There should be a line that looks like &quot;DMAR: IOMMU enabled&quot;. If there is no output, something is wrong.</p><h4 id="verify-iommu-interrupt-remapping-is-enabled">Verify IOMMU interrupt remapping is enabled</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&#x27;remapping&#x27;</span>
</span></code></pre><p>You should see one of the following lines:</p><pre class="bg-dark mb-3 p-4 rounded text-light"><code class="code-highlight"><span class="code-line">AMD-Vi: Interrupt remapping enabled
</span><span class="code-line">DMAR-IR: Enabled IRQ remapping in x2apic mode (&#x27;x2apic&#x27; can be different on old CPUs, but should still work)
</span></code></pre><h4 id="enable-iommu">Enable IOMMU</h4><h5 id="amd-1">AMD</h5><p>update to the following in /etc/default/grub:</p><pre class="language-ini"><code class="language-ini code-highlight"><span class="code-line"><span class="token key attr-name">GRUB_CMDLINE_LINUX</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">iommu=pt pcie_acs_override=downstream initcall_blacklist=sysfb_init</span>&quot;</span>
</span></code></pre><h5 id="intel-1">Intel</h5><p>update to the following in /etc/default/grub:</p><pre class="language-ini"><code class="language-ini code-highlight"><span class="code-line"><span class="token key attr-name">GRUB_CMDLINE_LINUX</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">intel_iommu=on iommu=pt initcall_blacklist=sysfb_init</span>&quot;</span>
</span></code></pre><h5 id="update-grub">Update grub</h5><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">update-grub</span>
</span><span class="code-line"><span class="token function">reboot</span>
</span><span class="code-line"><span class="token function">cat</span> /proc/cmdline
</span></code></pre><h4 id="vfio">VFIO</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;vfio&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modules
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;vfio_iommu_type1&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modules
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;vfio_pci&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modules
</span><span class="code-line">update-initramfs <span class="token parameter variable">-u</span> <span class="token parameter variable">-k</span> all
</span></code></pre><h5 id="get-hardware-ids">Get Hardware IDs</h5><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">lspci <span class="token parameter variable">-nnk</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-e</span> <span class="token string">&#x27;AMD&#x27;</span> <span class="token parameter variable">-e</span> <span class="token string">&#x27;Intel&#x27;</span>
</span><span class="code-line">pvesh get /nodes/<span class="token punctuation">{</span>nodename<span class="token punctuation">}</span>/hardware/pci --pci-class-blacklist <span class="token string">&quot;&quot;</span>
</span></code></pre><h5 id="amd-2">AMD</h5><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;options vfio-pci ids=1002:67df,1002:aaf0 disable_vga=1&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;softdep radeon pre: vfio-pci&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;softdep amdgpu pre: vfio-pci&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span></code></pre><h5 id="intel-2">Intel</h5><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;options vfio-pci ids=8086:5912,8086:a2f0 disable_vga=1&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;softdep i915 pre: vfio-pci&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;softdep snd_hda_intel pre: vfio-pci&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;softdep snd_hda_codec_hdmi pre: vfio-pci&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modprobe.d/vfio.conf
</span></code></pre><h5 id="verify-enabled">Verify Enabled</h5><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">reboot</span>
</span><span class="code-line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> vfio
</span><span class="code-line">lsmod <span class="token operator">|</span> <span class="token function">grep</span> vfio
</span></code></pre><h4 id="dump-gpu-bios">Dump GPU BIOS</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">cd</span> /sys/bus/pci/devices/0000:01:00.0/
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">&gt;</span> rom
</span><span class="code-line"><span class="token function">cat</span> rom <span class="token operator">&gt;</span> /usr/share/kvm/r9270.bin
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token number">0</span> <span class="token operator">&gt;</span> rom
</span></code></pre><h4 id="mediated-devices-vgpu-gvt-g">Mediated Devices (vGPU, GVT-g)</h4><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;i915.enable_gvt=1&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/modules
</span><span class="code-line"><span class="token function">ls</span> /sys/bus/pci/devices/0000:00:02.0/mdev_supported_types
</span><span class="code-line">lsmod <span class="token operator">|</span> <span class="token function">grep</span> kvmgt
</span><span class="code-line"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-iE</span> <span class="token string">&quot;gvt&quot;</span>
</span><span class="code-line"><span class="token function">cat</span> /sys/module/kvm_intel/parameters/nested
</span></code></pre><h2 id="proxmox-backup-server-bs">Proxmox Backup Server (BS)</h2><h3 id="proxmox-bs-post-install-script">Proxmox BS Post Install Script</h3><pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/post-pbs-install.sh<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/pbs_microcode.sh<span class="token variable">)</span></span>&quot;</span>
</span></code></pre><h3 id="create-datastore">Create Datastore</h3><ul><li>Navigate to https://{hostname}.local:8007</li><li>login</li><li>Add Datastore</li></ul><h2 id="setup-virtual-environment-nodes">Setup Virtual Environment Nodes</h2><h3 id="setup-network">Setup Network</h3><ul><li>Node -&gt; System -&gt; Network -&gt; Linux Bridge -&gt; Edit -&gt; VLAN aware</li><li>Node -&gt; System -&gt; Network -&gt; DNS<ul><li>Add 8.8.8.8</li><li>Add 8.8.4.4</li></ul></li></ul><h3 id="add-resource-mappings">Add Resource Mappings</h3><ul><li><p>Datacenter -&gt; Resource Mappings -&gt; PCI Devices -&gt; Add</p><ul><li>GPU1 = 0000:00:02.0</li><li>Sound = 0000:00:1f.3</li><li>WiFi = 0000:02:00.0</li></ul></li><li><p>Datacenter -&gt; Resource Mappings -&gt; USB Devices -&gt; Add</p><ul><li>Bluetooth = 8087:0a2a</li><li>Keyboard1 = 05af:8277</li><li>Mouse1 = 045e:076c</li></ul></li></ul><h3 id="connect-to-grafana">Connect to Grafana</h3><ul><li>Datacenter -&gt; Metric Server -&gt; Add -&gt; InfluxDB<ul><li>Name = cbridge</li><li>Enabled = Yes</li><li>Server = cbridge.local</li><li>Port = 8089</li></ul></li></ul><h3 id="add-remote-storage">Add Remote Storage</h3><h4 id="proxmox-backup-server">Proxmox Backup Server</h4><ul><li>Datacenter -&gt; Storage -&gt; Add -&gt; Proxmox Backup Server</li><li>Remove <code>VZDump backup</code> file from <code>local</code> Directory storage</li></ul><h4 id="nas">NAS</h4><ul><li>Datacenter -&gt; Storage -&gt; Add -&gt; NFS<ul><li>Remove <code>Disk image</code> and Add <code>ISO image</code> and <code>Container template</code></li></ul></li><li>Upload ISO images<ul><li>Debian 13 KDE</li><li>Windows 10</li><li>Windows 11</li><li>Virtio Windows Drivers</li></ul></li><li>Download Container templates<ul><li>debian-12-standard</li><li>ubuntu-24.04-standard</li></ul></li></ul></div><div class="col-lg-4"><div class="blog_sidebar__nmDWW position-sticky"><div class="p-4 mb-3 bg-light rounded"><h5>Related Content</h5><ul><li><a href="/projects/thinkpad">Thinkpads</a></li></ul><h5>Elsewhere</h5><ul><li><a href="/projects/printer">Anet A8</a></li><li><a href="/projects/printer-rook">Rook 2020</a></li><li><a href="/projects/printer-voron-0.2">Voron 0.2</a></li><li><a href="/projects/printer-voron-1.8">Voron 1.8</a></li><li><a href="/projects/printer-voron-2.4">Voron 2.4</a></li><li><a href="/projects/printer-polyformer">Polyformer</a></li><li><a href="/projects/3d-lab-print-piper-cub">3D LabPrint Piper Cub</a></li><li><a href="/projects/3d-sets-landy">3D Sets Landy</a></li><li><a href="/projects/openrc-f1">OpenRC F1</a></li><li><a href="/projects/openrc-truggy">OpenRC Truggy</a></li><li><a href="/projects/openrc-mini-quad">OpenRC Mini Quad</a></li><li><a href="/projects/knick-knacks">Knick Knacks</a></li><li><a href="/projects/fallout-wasteland-warfare">Fallout: Wasteland Warfare</a></li><li><a href="/projects/guitar">Guitar</a></li><li><a href="/projects/eurorack-modular-synth">Eurorack Modular Synth</a></li><li><a href="/projects/printer-klipper-fan-hat">Klipper Fan Hat</a></li><li><a href="/projects/homelab">Homelab</a></li><li><a href="/projects/cameras">Cameras</a></li><li><a href="/projects/horology">Horology</a></li></ul></div></div></div></div></div></article></div></main></div><div class="container"><footer class="d-flex flex-wrap py-3 border-top text-muted"><div class="d-flex align-items-center col">© 2016-<!-- -->2025<!-- --> Mike Thomas, All rights reserved.</div><div class="d-flex justify-content-end col"><a href="/projects/thinkcenter#__next">Back to top</a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"thinkcenter","related":["/projects/thinkpad"],"external":[],"title":"Thinkcenter","heading":"Getting small machines to create a Proxmox cluster","date":"2025-03-14T23:22:38.962Z","preview":"/assets/blog/thinkcenter/thinkcenter-hero.jpg","author":{"name":"Mike Thomas","picture":"/assets/authors/mike.jpg"},"description":"Making old outdated machines do modern things.","tags":["Computers"],"categories":[],"keywords":["Computers","Lenovo","Thinkcenter"],"promoted":false,"content":"\n# Table of contents\n\n# Intro\n\nMy first Thinkcenter was bought to replace my old “Shed Server” an old HP 3ghz pentium 4 pc with 1gb of ram that I rescued from e-waste from work.\n\nI upgraded it with a 320GB Western digital raptor drive and installed a student edition of windows server 2008 to run my website via IIS before I used to host it on GitHub Pages.\n\nIt was affectionately called the “Shed Server” as it was installed in my garden shed and connected to the internet via WiFi in my flat whilst I was in University.\n\nIt was likely due to this, why it eventually went to [Silicon Heaven](https://www.youtube.com/watch?v=lm6YnAqPv4w), probably due to the extreme changes in temperature, humidity or by being a home to many a spider.\n\nThe replacement for \"Shed Server\" was named \"Lenny\" (just because it is a Lenovo) and going forward my Proxmox cluster name of Thinkcenter Tinys has inherited the Monika.\n\n# The Machines\n\n## Small Form Factor\n\n| CPU           | Case     | Flashed with        | Bluetooth | Wifi                           | Extra | HDD                  | Memory             | Notes |\n| ------------- | -------- | ------------------- | --------- | ------------------------------ | ----- | -------------------- | ------------------ | ----- |\n| Core2Duo-6600 | A55 9638 | Windows Server 2008 |           | TP-Link Wireless-N PCI Adapter |       | 320GB WD Raptor 3.5\" | 4GB Samsung 666MHz |       |\n\n## Tiny 1L\n\n### Router\n\n| CPU      | Case  | Flashed with                                    | Bluetooth | Wifi | Extra                                                                   | NVME SDD                       | Memory               | Notes                                   |\n| -------- | ----- | ----------------------------------------------- | --------- | ---- | ----------------------------------------------------------------------- | ------------------------------ | -------------------- | --------------------------------------- |\n| i5-8500T | M720Q | [Proxmox VE (8.4.11)](https://www.proxmox.com/) |           |      | 256GB Sandisk 2.5\" SATA SSD \u0026 Intel PRO I350 Quad Port Gigabit Ethernet | 512GB Micron 3400 M.2 NVME SSD | 16GB Ramaxel 2666MHz | With Lenovo VESA Mount to mount to wall |\n\n\u003e [!NOTE]\n\u003e This machine will not be part of the main Proxmox cluster but will replace my main router with a OPNsense VM, and will also host VMs for [Proxmox Datacenter Manager](https://www.proxmox.com/en/about/company-details/press-releases/proxmox-datacenter-manager-alpha) and [Sonatype Nexus Repository Community Edition](https://www.sonatype.com/products/nexus-community-edition-download)\n\n### Proxmox Cluster\n\n| CPU      | Case  | Flashed with                                    | Bluetooth                | Wifi                            | Extra                                                                   | NVME SDD                         | Memory                | Notes                                         |\n| -------- | ----- | ----------------------------------------------- | ------------------------ | ------------------------------- | ----------------------------------------------------------------------- | -------------------------------- | --------------------- | --------------------------------------------- |\n| i5-8500T | M720Q | [Proxmox VE (8.4.11)](https://www.proxmox.com/) | Intel Bluetooth wireless | Intel Wireless 8265, No Antenna | 256GB Sandisk 2.5\" SATA SSD \u0026 Intel PRO I350 Quad Port Gigabit Ethernet | 1TB Crucial P3 Plus M.2 NVME SSD | 32GB Hypertec 2400MHz | Will be installed in [10\" Rack](homelab#rack) |\n| i5-8500T | M720Q | [Proxmox VE (8.4.11)](https://www.proxmox.com/) | Intel Bluetooth wireless | Intel Wireless 8265, No Antenna | 256GB Samsung 2.5\" SATA SSD                                             | 1TB Crucial P3 Plus M.2 NVME SSD | 32GB Hypertec 2400MHz | Will be installed in [10\" Rack](homelab#rack) |\n| i5-8500T | M720Q | [Proxmox VE (8.4.11)](https://www.proxmox.com/) | Intel Bluetooth wireless | Intel Wireless 8265, No Antenna | 256GB Samsung 2.5\" SATA SSD                                             | 1TB Crucial P3 Plus M.2 NVME SSD | 32GB Hypertec 2400MHz | Will be installed in [10\" Rack](homelab#rack) |\n\n### Desktops\n\n| CPU      | Case  | Flashed with                                   | Bluetooth                | Wifi                             | Extra                           | NVME SDD                    | Memory                | Notes                                                           |\n| -------- | ----- | ---------------------------------------------- | ------------------------ | -------------------------------- | ------------------------------- | --------------------------- | --------------------- | --------------------------------------------------------------- |\n| i5-8400T | M720Q | Windows 11 Pro 64                              |                          |                                  | 256GB Micron 1300 2.5\" SATA SSD |                             | 16GB Micron 2133MHz   |                                                                 |\n| i5-8400T | M720Q | Windows 11 Pro 64                              | Intel Bluetooth wireless | Intel Wireless 8265              | 256GB Micron 1300 2.5\" SATA SSD |                             | 16GB Micron 2666MHz   |                                                                 |\n| i5-9400T | M720Q | Windows 11 Pro 64                              |                          |                                  | 256GB Micron 1300 2.5\" SATA SSD |                             | 16GB SK Hynix 2666MHz |                                                                 |\n| i5-9400T | M720Q | Windows 11 Pro 64                              | Intel Bluetooth wireless | Intel Wireless 8265              | 256GB Micron 1300 2.5\" SATA SSD |                             | 16GB SK Hynix 2666MHz |                                                                 |\n| i7-7700T | M710Q | [Proxmox VE (9.0.5)](https://www.proxmox.com/) | Intel Bluetooth wireless | Intel Dual Band Wireless-AC 3165 | 1TB WD Black 2.5\" SATA HDD      | 256GB WD Black M.2 NVME SSD | 16GB SK Hynix 2400MHz | Currently using to test upgrade to Proxmox 9 with Debian Trixie |\n\n# Sonatype Nexus Repository\n\nAs most of the Operating Systems I use are based upon Debian I have chosen to install Nexus to host APT proxies for the main Debian repositories so that updates will only be downloaded once and each machine can then retrieve the local copy from Nexus rather than having to re-download the updates from the internet.\n\n## Download Nexus and Install to `/srv`\n\n```sh\ncd Downloads/\nwget https://download.sonatype.com/nexus/3/nexus-3.83.1-03-linux-x86_64.tar.gz\ntar xvf nexus-3.83.1-03-linux-x86_64.tar.gz\nsudo mv nexus-3.83.1-03 /srv\nsudo mv sonatype-work/ /srv\nsudo adduser nexus --system\nsudo chown -R nexus:nogroup /srv/nexus-3.83.1-03/\nsudo chown -R nexus:nogroup /srv/sonatype-work/\n```\n\n## Update Config\n\nAdd the following to `/srv/nexus-3.83.1-03/bin/nexus.rc`:\n\n```ini\nrun_as_user=\"nexus\"\n```\n\nAdd the following to `/srv/nexus-3.83.1-03/bin/nexus.vmoptions`:\n\n```ini\n# Updated Memory Size\n  -Xms1200m\n  -Xmx1200m\n  -XX:MaxDirectMemorySize=2G\n# Added User Root to fix file permissions error on nexus boot\n-Djava.util.prefs.userRoot=../sonatype-work/nexus3/javaprefs\n```\n\n## Install As Service\n\nCreate a symbolic link to the binary of the latest Nexus version:\n\n```sh\nsudo ln -s /srv/nexus-3.83.1-03/bin/nexus /etc/init.d/nexus\n```\n\nCreate the file `/etc/systemd/system/nexus.service` with the content:\n\n```ini\n[Unit]\nDescription=nexus service\nAfter=network.target\n\n[Service]\nType=forking\nLimitNOFILE=65536\nExecStart=/etc/init.d/nexus start\nExecStop=/etc/init.d/nexus stop\nUser=nexus\nRestart=on-abort\nTimeoutSec=600\n\n[Install]\nWantedBy=multi-user.target\n```\n\nEnable and start the service and check the logs:\n\n```sh\nsudo systemctl daemon-reload\nsudo systemctl enable nexus.service\nsudo systemctl start nexus.service\njournalctl -xeu nexus.service\ntail -f /srv/sonatype-work/nexus3/log/nexus.log\ncat /srv/sonatype-work/nexus3/log/nexus.log | grep ERROR\ncat /srv/sonatype-work/nexus3/log/nexus.log | grep WARN\n```\n\n## Nexus Frontend\n\n```sh\ncat /opt/sonatype-work/nexus3/admin.password\n```\n\n- Visit http://localhost:8081/\n- Change Admin Password\n- Add APT Proxies\n  - [adoptium](https://packages.adoptium.net/artifactory/deb)\n  - [debian](http://deb.debian.org/debian/)\n  - [debian-security](http://security.debian.org/debian-security/)\n  - [docker-debian](https://download.docker.com/linux/debian)\n  - [docker-raspbian](https://download.docker.com/linux/raspbian)\n  - [mozilla](https://packages.mozilla.org/apt)\n  - [openmediavault-packages](https://openmediavault.github.io/packages/)\n  - [openmediavault-public](http://packages.openmediavault.org/public/)\n  - [pi-top-os](https://packages.pi-top.com/pi-top-os/debian/)\n  - [proxmox-bs](http://download.proxmox.com/debian/pbs)\n  - [proxmox-dm](http://download.proxmox.com/debian/pdm)\n  - [proxmox-ve](http://download.proxmox.com/debian/pve)\n  - [raspbian](http://raspbian.raspberrypi.org/raspbian/)\n  - [raspi](http://archive.raspberrypi.com/debian/)\n\n# Proxmox Virtual Environment (VE)\n\nEach of the nodes that I want to run Proxmox on will be set up with the following config.\n\n## Proxmox VE Post Install Script\n\n```sh\nbash -c \"$(curl -fsSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/post-pve-install.sh)\"\nbash -c \"$(curl -fsSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/scaling-governor.sh)\"\nbash -c \"$(curl -fsSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/microcode.sh)\"\n```\n\n## Update APT Repositories\n\nOne of the first things I do when setting up a new machine is to update apt to use the Nexus repository we set up in the last section.\n\n```sh\nnano /etc/apt/auth.conf.d/nexus.mikethomas.info.conf\nnano /etc/apt/sources.list\nnano /etc/apt/sources.list.d/ceph.list\nnano /etc/apt/sources.list.d/pve-enterprise.list\nnano /etc/apt/sources.list.d/pbs-enterprise.list\nnano /etc/apt/sources.list.d/pve-install-repo.list\nnano /etc/apt/sources.list.d/pbs-install-repo.list\nnano /etc/apt/sources.list.d/pvetest-for-beta.list\nnano /etc/apt/sources.list.d/pbstest-for-beta.list\n```\n\n## Install Useful tools\n\n```sh\napt update\napt install avahi-daemon htop net-tools\nsystemctl status avahi-daemon\nhtop\nifconfig\n```\n\n## Microcode\n\n### AMD\n\n```sh\napt list --installed | grep microcode\napt install amd64-microcode\ndmesg | grep microcode\n```\n\n### Intel\n\n```sh\napt list --installed | grep microcode\napt install intel-microcode\ndmesg | grep microcode\n```\n\n## Sensors\n\n```sh\napt install lm-sensors\nmodprobe nct6683 force=on\nsensors\n```\n\n## Update Container images\n\n```sh\npveam update\n```\n\n## HDMI audio crackling fix\n\n```sh\necho \"options snd-hda-intel enable_msi=1\" \u003e\u003e /etc/modprobe.d/snd-hda-intel.conf\n```\n\n## PCI(e) Passthrough\n\n### Verify IOMMU is enabled\n\n```sh\ndmesg | grep -e AMD -e DMAR -e IOMMU\n```\n\nThere should be a line that looks like \"DMAR: IOMMU enabled\". If there is no output, something is wrong.\n\n### Verify IOMMU interrupt remapping is enabled\n\n```sh\ndmesg | grep 'remapping'\n```\n\nYou should see one of the following lines:\n\n```\nAMD-Vi: Interrupt remapping enabled\nDMAR-IR: Enabled IRQ remapping in x2apic mode ('x2apic' can be different on old CPUs, but should still work)\n```\n\n### Enable IOMMU\n\n#### AMD\n\nupdate to the following in /etc/default/grub:\n\n```ini\nGRUB_CMDLINE_LINUX=\"iommu=pt pcie_acs_override=downstream initcall_blacklist=sysfb_init\"\n```\n\n#### Intel\n\nupdate to the following in /etc/default/grub:\n\n```ini\nGRUB_CMDLINE_LINUX=\"intel_iommu=on iommu=pt initcall_blacklist=sysfb_init\"\n```\n\n#### Update grub\n\n```sh\nupdate-grub\nreboot\ncat /proc/cmdline\n```\n\n### VFIO\n\n```sh\necho \"vfio\" \u003e\u003e /etc/modules\necho \"vfio_iommu_type1\" \u003e\u003e /etc/modules\necho \"vfio_pci\" \u003e\u003e /etc/modules\nupdate-initramfs -u -k all\n```\n\n#### Get Hardware IDs\n\n```sh\nlspci -nnk | grep -e 'AMD' -e 'Intel'\npvesh get /nodes/{nodename}/hardware/pci --pci-class-blacklist \"\"\n```\n\n#### AMD\n\n```sh\necho \"options vfio-pci ids=1002:67df,1002:aaf0 disable_vga=1\" \u003e\u003e /etc/modprobe.d/vfio.conf\necho \"softdep radeon pre: vfio-pci\" \u003e\u003e /etc/modprobe.d/vfio.conf\necho \"softdep amdgpu pre: vfio-pci\" \u003e\u003e /etc/modprobe.d/vfio.conf\n```\n\n#### Intel\n\n```sh\necho \"options vfio-pci ids=8086:5912,8086:a2f0 disable_vga=1\" \u003e\u003e /etc/modprobe.d/vfio.conf\necho \"softdep i915 pre: vfio-pci\" \u003e\u003e /etc/modprobe.d/vfio.conf\necho \"softdep snd_hda_intel pre: vfio-pci\" \u003e\u003e /etc/modprobe.d/vfio.conf\necho \"softdep snd_hda_codec_hdmi pre: vfio-pci\" \u003e\u003e /etc/modprobe.d/vfio.conf\n```\n\n#### Verify Enabled\n\n```sh\nreboot\ndmesg | grep -i vfio\nlsmod | grep vfio\n```\n\n### Dump GPU BIOS\n\n```sh\ncd /sys/bus/pci/devices/0000:01:00.0/\necho 1 \u003e rom\ncat rom \u003e /usr/share/kvm/r9270.bin\necho 0 \u003e rom\n```\n\n### Mediated Devices (vGPU, GVT-g)\n\n```sh\necho \"i915.enable_gvt=1\" \u003e\u003e /etc/modules\nls /sys/bus/pci/devices/0000:00:02.0/mdev_supported_types\nlsmod | grep kvmgt\ndmesg | grep -iE \"gvt\"\ncat /sys/module/kvm_intel/parameters/nested\n```\n\n# Proxmox Backup Server (BS)\n\n## Proxmox BS Post Install Script\n\n```sh\nbash -c \"$(curl -fsSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/post-pbs-install.sh)\"\nbash -c \"$(curl -fsSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/tools/pve/pbs_microcode.sh)\"\n```\n\n## Create Datastore\n\n- Navigate to https://{hostname}.local:8007\n- login\n- Add Datastore\n\n# Setup Virtual Environment Nodes\n\n## Setup Network\n\n- Node -\u003e System -\u003e Network -\u003e Linux Bridge -\u003e Edit -\u003e VLAN aware\n- Node -\u003e System -\u003e Network -\u003e DNS\n  - Add 8.8.8.8\n  - Add 8.8.4.4\n\n## Add Resource Mappings\n\n- Datacenter -\u003e Resource Mappings -\u003e PCI Devices -\u003e Add\n  - GPU1 = 0000:00:02.0\n  - Sound = 0000:00:1f.3\n  - WiFi = 0000:02:00.0\n\n- Datacenter -\u003e Resource Mappings -\u003e USB Devices -\u003e Add\n  - Bluetooth = 8087:0a2a\n  - Keyboard1 = 05af:8277\n  - Mouse1 = 045e:076c\n\n## Connect to Grafana\n\n- Datacenter -\u003e Metric Server -\u003e Add -\u003e InfluxDB\n  - Name = cbridge\n  - Enabled = Yes\n  - Server = cbridge.local\n  - Port = 8089\n\n## Add Remote Storage\n\n### Proxmox Backup Server\n\n- Datacenter -\u003e Storage -\u003e Add -\u003e Proxmox Backup Server\n- Remove `VZDump backup` file from `local` Directory storage\n\n### NAS\n\n- Datacenter -\u003e Storage -\u003e Add -\u003e NFS\n  - Remove `Disk image` and Add `ISO image` and `Container template`\n- Upload ISO images\n  - Debian 13 KDE\n  - Windows 10\n  - Windows 11\n  - Virtio Windows Drivers\n- Download Container templates\n  - debian-12-standard\n  - ubuntu-24.04-standard\n","lastmod":"2025-08-28T16:41:34.471Z"},"related":[{"slug":"thinkpad","related":[],"external":[],"title":"Thinkpads","heading":"","date":"","preview":"/assets/blog/thinkpad/thinkpad-hero.jpg","author":{"name":"","picture":""},"description":"","tags":[],"categories":[],"keywords":[],"promoted":false,"content":""}]},"__N_SSG":true},"page":"/projects/[slug]","query":{"slug":"thinkcenter"},"buildId":"Y5mSgE8YhqnLmiRs80-DT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>