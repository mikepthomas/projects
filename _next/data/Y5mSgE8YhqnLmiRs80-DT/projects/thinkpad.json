{"pageProps":{"post":{"slug":"thinkpad","related":["/projects/thinkcenter"],"external":[],"title":"Thinkpads","heading":"Adventures with Thinkpads","date":"2017-11-13T00:00:00.000Z","preview":"/assets/blog/thinkpad/thinkpad-hero.jpg","author":{"name":"Mike Thomas","picture":"/assets/authors/mike.jpg"},"description":"The many tinkerings with the internals of an X220 Thinkpad.","tags":["Computers","Raspberry Pi"],"categories":[],"keywords":["Computers","Lenovo","Thinkpad"],"promoted":false,"content":"\n# Table of contents\n\n# Freenode Live 2017\n\n![My Exhibitor Lanyard from Freenode Live](/assets/blog/thinkpad/freenode-exhibitor.jpg)\n\nI was a volunteer helping out the [Free Software Foundation](https://www.fsf.org/) at Frennode Live 2017 in Bristol, where I got talking to some really interesting people and played on some Thinkpads running entirely Free software. This made me want to build my own.\n\n# Hardware Upgrades\n\n![Parts to upgrade my Thinkpad X220](/assets/blog/thinkpad/upgrades.jpg)\n\n## Repairs\n\n![Cracked plastics on a laptop](/assets/blog/thinkpad/cracked.jpg)\n\nI brought the laptop for cheap from a seller on eBay. The laptop was quite dirty, has some shiny keys and trackpad and some cracked plastics. my first job was to clean it up and replace the broken parts.\n\n![Using Araldite to fix split lid of the laptop](/assets/blog/thinkpad/repairing-split-lid.jpg)\n\nI also used Araldite to fix the broken parts where there is a split in the lid of the laptop.\n\n## Bluetooth Upgrade\n\n![The Bluetooth module is separate from the Wifi module](/assets/blog/thinkpad/bluetooth.jpg)\n\nBluetooth can be upgraded to Bluetooth 4.0 by simply swapping out the daughter card located under the palm rest.\n\n![A Bluetooth 4.0 compatable card salvaged from a broken X230](/assets/blog/thinkpad/bluetooth-upgrade.jpg)\n\n## Processor Upgrade\n\n![The Cables are routed through the keyboard carrier](/assets/blog/thinkpad/cable-routing.jpg)\n\nThe Laptop came with an Intel i5 processor however the BIOS was locked with a password so I purchased a second hand motherboard with an Intel i7 and swapped the motherboards over.\n\n![There are only a few screws holding the motherboard in](/assets/blog/thinkpad/mainboard-screw-locations.jpg)\n\n## 4G Modem\n\n![4G Modem installed in the machine](/assets/blog/thinkpad/4g-modem.jpg)\n\nThe Laptop came with a 4G modem installed and there is a SIM Card slot in the battery compartment. The module seemed to be locked to the Vodafone network and was quite expensive to use on PAYG.\n\n## Solid State Drives\n\n![So good I brought it twice](/assets/blog/thinkpad/they-are-multiplying.jpg)\n\nI liked the laptop so much I purchased another one.\n\n![A Generic SSD Module](/assets/blog/thinkpad/generic-ssd.jpg)\n\nThe newer machine came with a small (32GB I believe) generic SSD.\n\n![A Crucial SSD Module](/assets/blog/thinkpad/crucial-ssd.jpg)\n\nI replaced it with a larger Crucial branded SSD.\n\n![A Samsung SSD Module](/assets/blog/thinkpad/samsung-ssd.jpg)\n\nAnd whilst I was at it I replaced the 4G Modem in the other laptop with an SSD too.\n\n## Memory\n\nI have now also updated both machines with the maximum that they support. 16GB of Crucial memory in the laptop with a Crucial SSD and 16GB of Samsung memory in the machine with a Samsung SSD.\n\n# The Machines\n\nI have recently won another Ebay auction for Â£42.26 that contained 2 X230s and another X220.\n\n## X220\n\n| CPU      | Case                        | Flashed with                                                                                            | Bluetooth    | Wifi                           | Extra                        | HDD                     | Memory                               |\n| -------- | --------------------------- | ------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------ | ---------------------------- | ----------------------- | ------------------------------------ |\n| i7-2620M | Complete, IPS Panel         | [Modified BIOS v1.46](https://www.mediafire.com/file/egzdbbm54a5jkqf/X220_v1.46_Modified_BIOS.zip/file) | Broadcom 3.0 | Dell DW1510 (For macOS)        | 240GB Crucial M500 mSATA SSD | 128GB Crucial MX100 SSD | 16GB Crucial Mac 1600MHz             |\n| i7-2640M | Complete, IPS Panel         | [Modified BIOS v1.46](https://www.mediafire.com/file/egzdbbm54a5jkqf/X220_v1.46_Modified_BIOS.zip/file) | Broadcom 4.0 | Intel Centrino Advanced-N 6205 | Ericsson 4G Modem            | 256GB Crucial M550 SSD  | 16GB Crucial Ballistix Sport 1600MHz |\n| i5-2520M | Complete, TN Panel          | Libreboot (Original Stock BIOS v1.31)                                                                   | Broadcom 3.0 | Atheros AR5B95 (For Trisquel)  |                              | 320GB Hitachi HDD       | 8GB Samsung 1333MHz                  |\n| i5-2540M | Broken IPS Panel, No Webcam |                                                                                                         |              |                                |                              |                         | 8GB Crucial 1333MHz                  |\n\n## X230\n\n| CPU      | Case               | Flashed with     | Bluetooth    | Wifi                           | Extra | HDD                | Memory                                   |\n| -------- | ------------------ | ---------------- | ------------ | ------------------------------ | ----- | ------------------ | ---------------------------------------- |\n| i5-3320M | Complete, TN Panel | Stock BIOS v2.77 | Broadcom 4.0 | Intel Centrino Advanced-N 6205 |       |                    | 8GB Hynix 1600MHz                        |\n| i5-3320M | Complete, TN Panel | Stock BIOS v2.77 | Broadcom 4.0 | Intel Centrino Advanced-N 6205 |       | 500GB Seagate SSHD | 4GB Samsung 1600MHz & 4GB Micron 1600MHz |\n\n## Batteries\n\n### Big X220\n\n| Item        | Type | Full Charge Capacity | Cycle Count |\n| ----------- | ---- | -------------------- | ----------- |\n| 1ZJBF22E2KF | 29++ | 10.81 Wh             | 329         |\n| 1ZJBF24J0L8 | 29++ | 77.49 Wh             | 85          |\n| 1ZKFT27R43W | 44++ | 68.87 Wh             | 511         |\n\n### Small X220\n\n| Item        | Type | Full Charge Capacity | Cycle Count |\n| ----------- | ---- | -------------------- | ----------- |\n| 1ZJRJ17650D | 29+  | 54.75 Wh             | 94          |\n| 1ZKFS2541BX | 44+  | 38.81 Wh             | 102         |\n\n### Small X230\n\n| Item        | Type | Full Charge Capacity | Cycle Count |\n| ----------- | ---- | -------------------- | ----------- |\n| 1ZS1333DB9A | 44+  | 53 Wh                | 136         |\n| 1ZS133AWAP9 | 44+  | 58.41 Wh             | 234         |\n\n## Spares\n\n- Atheros AR5B95 (For Trisquel)\n- Dell DW1510 (For macOS)\n- Intel Centrino Advanced-N 6205\n- Intel Centrino Wireless-N 1000\n- Ericsson 4G Modem\n- 128GB Samsung mSATA SSD\n- 128GB Samsung mSATA SSD\n\n# BIOS Flashing\n\n## Backup Stock BIOS\n\n![The Stock Thinkpad X220 BIOS screen](/assets/blog/thinkpad/stock-bios.jpg)\n\nThe stock BIOS screen.\n\n![Tools to flash the BIOS chip in the laptop](/assets/blog/thinkpad/flashing-tools.jpg)\n\nCollecting the tools required to flash the BIOS:\n\n- A Multimeter\n- Some DuPont wires\n- A Pomona 5250 clip\n- A Raspberry Pi\n\n![Connecting a Raspberry Pi to Flash the BIOS](/assets/blog/thinkpad/raspberry-pi-connection.jpg)\n\n### Laptop Pinout\n\n```\nScreen (furthest from you)\n            __\n MOSI  5 --|  |-- 4  GND\n  CLK  6 --|  |-- 3  N/C\n  N/C  7 --|  |-- 2  MISO\n  VCC  8 --|__|-- 1  CS\n\nPalm Rest (closest to you)\n```\n\n### Pi Pinout\n\n```\nEdge of pi (furthest from you)\n\nL                                                             CS\nE                                                             |\nF +--------------------------------------------------------------------------------------------------------+\nT |    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    |\n  |    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    x    |\nE +--------------------------------------------^----^----^----^---------------------------------------^----+\nD                                              |    |    |    |                                       |\nG                                             3.3V  MOSI MISO |                                      GND\nE                                           (VCC)            CLK\n\nBody of Pi (closest to you)\n```\n\nConnecting a Raspberry Pi to read from and write to the BIOS chip.\n\n![Backing up the Stock BIOS](/assets/blog/thinkpad/bios-backup.jpg)\n\nIt's always a good idea to read the BIOS data from the chip twice and compare the compare the MD5 hashes to ensure it has been copied correctly.\n\nOne of my X220s had a different brand EEPROM chip than the Winbond one in the screenshot above:\n\n```bash {1}\n$ flashrom -p linux_spi:dev=/dev/spidev0.0\nflashrom unknown on Linux 6.1.0-rpi8-rpi-v8 (aarch64)\nflashrom is free software, get the source code at https://flashrom.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\nUsing default 2000kHz clock. Use 'spispeed' parameter to override.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on linux_spi.\nFound Macronix flash chip \"MX25L6405D\" (8192 kB, SPI) on linux_spi.\nFound Macronix flash chip \"MX25L6406E/MX25L6408E\" (8192 kB, SPI) on linux_spi.\nFound Macronix flash chip \"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F\" (8192 kB, SPI) on linux_spi.\nMultiple flash chip definitions match the detected chip(s): \"MX25L6405\", \"MX25L6405D\", \"MX25L6406E/MX25L6408E\", \"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F\"\nPlease specify which chip definition to use with the -c <chipname> option.\n```\n\nTo connect to this chip I had to pass the `-c` parameter\n\n```bash {1}\n$ flashrom -p linux_spi:dev=/dev/spidev0.0 -c MX25L6405\nflashrom unknown on Linux 6.1.0-rpi8-rpi-v8 (aarch64)\nflashrom is free software, get the source code at https://flashrom.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\nUsing default 2000kHz clock. Use 'spispeed' parameter to override.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on linux_spi.\n===\nThis flash part has status UNTESTED for operations: WP\nThe test status of this chip may have been updated in the latest development\nversion of flashrom. If you are running the latest development version,\nplease email a report to flashrom@flashrom.org if any of the above operations\nwork correctly for you with this flash chip. Please include the flashrom log\nfile for all operations you tested (see the man page for details), and mention\nwhich mainboard or programmer you tested in the subject line.\nThanks for your help!\nNo operations were specified.\n```\n\n## Coreboot\n\n[Coreboot](https://www.coreboot.org/) is on Open Source BIOS replacement.\n\n![Flashing Coreboot with SeaBIOS Payload](/assets/blog/thinkpad/bios-flashing.jpg)\n\nCrossing my fingers and overwriting the stock BIOS.\n\n![SeaBIOS running on the laptop](/assets/blog/thinkpad/seabios.jpg)\n\nIt Works! Running the SeaBIOS Payload using [Coreboot](https://www.coreboot.org/).\n\n## Libreboot\n\n![Libreboot running on the laptop](/assets/blog/thinkpad/libreboot.jpg)\n\n\"[Libreboot](https://libreboot.org/) is specifically a coreboot distribution\". It simplifies the install with pre-compiled images and also provides scripts to simplify compillation.\n\nI used Debian 12 Bookworm to build Libreboot from sources:\n\n```bash {1-6, 8}\n$ git clone https://codeberg.org/libreboot/lbmk\n$ cd lbmk\n$ git config --global user.name \"Mike Thomas\"\n$ git config --global user.email mikepthomas@outlook.com\n$ sudo apt install python-is-python3\n$ sudo ./mk dependencies debian\n...\n$ ./mk -b coreboot list\n```\n\n### Compiling\n\n#### X220\n\n```bash {1}\n$ ./mk -b coreboot x220_8mb\n...\n...\n...\nCreated CBFS (capacity = 8191460 bytes)\n    BOOTBLOCK\n    CBFS       cbfs_master_header\n    CBFS       cpu_microcode_blob.bin\n    CBFS       fallback/romstage\nImage SIZE 8388608\n    CBFS       fallback/ramstage\n    CBFS       config\n    CBFS       revision\n    CBFS       build_info\n    CBFS       fallback/dsdt.aml\n    CBFS       vbt.bin\n    CBFS       cmos.default\n    CBFS       cmos_layout.bin\n    CBFS       fallback/postcar\n    DD         Adding Intel Firmware Descriptor\n    IFDTOOL    me.bin -> coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 8388608 bytes\nFile build/me.bin is 86016 bytes\nAdding build/me.bin as the Intel ME section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    gbe.bin -> coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 8388608 bytes\nFile ../../../config/ifd/xx20/gbe is 8192 bytes\nAdding ../../../config/ifd/xx20/gbe as the GbE section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    Unlocking Management Engine\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 8388608 bytes\nWriting new image to build/coreboot.pre\n    CBFS       coreboot.rom\n    CBFSLAYOUT  coreboot.rom\n\nThis image contains the following sections that can be manipulated with this tool:\n\n'RW_MRC_CACHE' (size 65536, offset 131072)\n'COREBOOT' (CBFS, size 8191488, offset 197120)\n\nIt is possible to perform either the write action or the CBFS add/remove actions on every section listed above.\nTo see the image's read-only sections as well, rerun with the -w option.\n    CBFSPRINT  coreboot.rom\n\nFMAP REGION: COREBOOT\nName                           Offset     Type           Size   Comp\ncbfs_master_header             0x0        cbfs header        32 none\ncpu_microcode_blob.bin         0x80       microcode       26624 none\nfallback/romstage              0x68c0     stage           90608 none\nfallback/ramstage              0x1cb40    stage          121009 LZMA (257980 decompressed)\nconfig                         0x3a480    raw              3267 LZMA (10422 decompressed)\nrevision                       0x3b180    raw               727 none\nbuild_info                     0x3b480    raw               110 none\nfallback/dsdt.aml              0x3b540    raw             14765 none\nvbt.bin                        0x3ef40    raw              1400 LZMA (3985 decompressed)\ncmos.default                   0x3f500    cmos_default      256 none\ncmos_layout.bin                0x3f640    cmos_layout      1976 none\nfallback/postcar               0x3fe40    stage           21680 none\n(empty)                        0x45340    null          7887460 none\nbootblock                      0x7cadc0   bootblock       20480 none\n\nBuilt lenovo/x220 (ThinkPad X220)\n\nccache statistics\nCacheable calls:             759 / 784 (96.81%)\n  Hits:                      753 / 759 (99.21%)\n    Direct:                   80 / 753 (10.62%)\n    Preprocessed:            673 / 753 (89.38%)\n  Misses:                      6 / 759 ( 0.79%)\nUncacheable calls:            25 / 784 ( 3.19%)\n  Called for linking:         12 /  25 (48.00%)\n  Called for preprocessing:   13 /  25 (52.00%)\nSuccessful lookups:\n  Direct:                     80 / 759 (10.54%)\n  Preprocessed:              673 / 679 (99.12%)\nLocal storage:\n  Hits:                      753 / 759 (99.21%)\n  Misses:                      6 / 759 ( 0.79%)\n  Reads:                    1518\n  Writes:                    685\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\nCONFIG_PAYLOAD_NONE=y\nmake: Entering directory '/home/mike/Repos/lbmk/src/coreboot/default'\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\n```\n\n#### X230\n\n```bash {1}\n$ ./mk -b coreboot x230_12mb\n...\n...\n...\nCreated CBFS (capacity = 12385764 bytes)\n    BOOTBLOCK\n    CBFS       cbfs_master_header\n    CBFS       cpu_microcode_blob.bin\n    CBFS       fallback/romstage\nImage SIZE 12582912\n    CBFS       fallback/ramstage\n    CBFS       config\n    CBFS       revision\n    CBFS       build_info\n    CBFS       fallback/dsdt.aml\n    CBFS       vbt.bin\n    CBFS       cmos.default\n    CBFS       cmos_layout.bin\n    CBFS       fallback/postcar\n    DD         Adding Intel Firmware Descriptor\n    IFDTOOL    me.bin -> coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 12582912 bytes\nFile build/me.bin is 98304 bytes\nAdding build/me.bin as the Intel ME section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    gbe.bin -> coreboot.pre\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 12582912 bytes\nFile ../../../config/ifd/xx30/gbe is 8192 bytes\nAdding ../../../config/ifd/xx30/gbe as the GbE section of build/coreboot.pre\nWriting new image to build/coreboot.pre\n    IFDTOOL    Unlocking Management Engine\nWarning: No platform specified. Output may be incomplete\nFile build/coreboot.pre is 12582912 bytes\nWriting new image to build/coreboot.pre\n    CBFS       coreboot.rom\n    CBFSLAYOUT  coreboot.rom\n\nThis image contains the following sections that can be manipulated with this tool:\n\n'RW_MRC_CACHE' (size 65536, offset 131072)\n'COREBOOT' (CBFS, size 12385792, offset 197120)\n\nIt is possible to perform either the write action or the CBFS add/remove actions on every section listed above.\nTo see the image's read-only sections as well, rerun with the -w option.\n    CBFSPRINT  coreboot.rom\n\nFMAP REGION: COREBOOT\nName                           Offset     Type           Size   Comp\ncbfs_master_header             0x0        cbfs header        32 none\ncpu_microcode_blob.bin         0x80       microcode       26624 none\nfallback/romstage              0x68c0     stage           87216 none\nfallback/ramstage              0x1be00    stage          118954 LZMA (252084 decompressed)\nconfig                         0x38f00    raw              3274 LZMA (10428 decompressed)\nrevision                       0x39c00    raw               727 none\nbuild_info                     0x39f00    raw               110 none\nfallback/dsdt.aml              0x39fc0    raw             14765 none\nvbt.bin                        0x3d9c0    raw              1433 LZMA (4281 decompressed)\ncmos.default                   0x3dfc0    cmos_default      256 none\ncmos_layout.bin                0x3e100    cmos_layout      2012 none\nfallback/postcar               0x3e940    stage           21680 none\n(empty)                        0x43e40    null         12087140 none\nbootblock                      0xbcadc0   bootblock       20480 none\n\nBuilt lenovo/x230 (ThinkPad X230)\n\nccache statistics\nCacheable calls:             759 / 784 (96.81%)\n  Hits:                      758 / 759 (99.87%)\n    Direct:                   80 / 758 (10.55%)\n    Preprocessed:            678 / 758 (89.45%)\n  Misses:                      1 / 759 ( 0.13%)\nUncacheable calls:            25 / 784 ( 3.19%)\n  Called for linking:         12 /  25 (48.00%)\n  Called for preprocessing:   13 /  25 (52.00%)\nSuccessful lookups:\n  Direct:                     80 / 759 (10.54%)\n  Preprocessed:              678 / 679 (99.85%)\nLocal storage:\n  Hits:                      758 / 759 (99.87%)\n  Misses:                      1 / 759 ( 0.13%)\n  Reads:                    1518\n  Writes:                    680\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\nCONFIG_PAYLOAD_NONE=y\nmake: Entering directory '/home/mike/Repos/lbmk/src/coreboot/default'\nmake: Leaving directory '/home/mike/Repos/lbmk/src/coreboot/default'\n```\n\n### Prepare a Release image\n\nGet the latest release rom from [a mirror on the Downloads page](https://libreboot.org/download.html) and verify the sha512 e.g:\n\n```bash {1, 13, 25}\n$ wget https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz\n--2024-08-28 15:46:01--  https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz\nResolving www.mirrorservice.org (www.mirrorservice.org)... 212.219.56.184, 2001:630:341:12::184\nConnecting to www.mirrorservice.org (www.mirrorservice.org)|212.219.56.184|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3288796 (3.1M) [application/x-xz]\nSaving to: âlibreboot-20240612_x220_8mb.tar.xzâ\n\nlibreboot-20240612_x220_8mb.tar.xz                    100%[=======================================================================================================================>]   3.14M  19.6MB/s    in 0.2s\n\n2024-08-28 15:46:01 (19.6 MB/s) - âlibreboot-20240612_x220_8mb.tar.xzâ saved [3288796/3288796]\n\n$ wget https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz.sha512\n--2024-08-28 15:46:17--  https://www.mirrorservice.org/sites/libreboot.org/release/stable/20240612/roms/libreboot-20240612_x220_8mb.tar.xz.sha512\nResolving www.mirrorservice.org (www.mirrorservice.org)... 212.219.56.184, 2001:630:341:12::184\nConnecting to www.mirrorservice.org (www.mirrorservice.org)|212.219.56.184|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 167 [application/x-xz]\nSaving to: âlibreboot-20240612_x220_8mb.tar.xz.sha512â\n\nlibreboot-20240612_x220_8mb.tar.xz.sha512             100%[=======================================================================================================================>]     167  --.-KB/s    in 0s\n\n2024-08-28 15:46:17 (78.4 MB/s) - âlibreboot-20240612_x220_8mb.tar.xz.sha512â saved [167/167]\n\n$ sha512sum -c libreboot-20240612_x220_8mb.tar.xz.sha512\n./libreboot-20240612_x220_8mb.tar.xz: OK\n```\n\nInject the Management Engine into a Release image:\n\n```bash {1}\n$ ./vendor inject libreboot-20240612_x220_8mb.tar.xz\n...\nFile tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom is 8388608 bytes\nFile vendorfiles/xx20/me.bin is 86016 bytes\nAdding vendorfiles/xx20/me.bin as the Intel ME section of tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nWriting new image to tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nROM image successfully patched: tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nWarning: No platform specified. Output may be incomplete\nFile tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom is 8388608 bytes\nFile vendorfiles/xx20/me.bin is 86016 bytes\nAdding vendorfiles/xx20/me.bin as the Intel ME section of tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nWriting new image to tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nROM image successfully patched: tmp/romdir/bin/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nWarning: No platform specified. Output may be incomplete\n...\n```\n\nMake sure the Management Engine is present before flashing the image:\n\n```bash {1, 3, 11}\n$ ./mk -d coreboot x220_8mb\n...\n$ ./elf/ifdtool/default/ifdtool -x bin/release/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom\nWarning: No platform specified. Output may be incomplete\nFile bin/release/x220_8mb/seabios_withgrub_x220_8mb_libgfxinit_corebootfb_ukqwerty_grubfirst.rom is 8388608 bytes\n  Flash Region 0 (Flash Descriptor): 00000000 - 00000fff\n  Flash Region 1 (BIOS): 00018000 - 007fffff\n  Flash Region 2 (Intel ME): 00003000 - 00017fff\n  Flash Region 3 (GbE): 00001000 - 00002fff\n  Flash Region 4 (Platform Data): 00fff000 - 00000fff (unused)\n$ hexdump flashregion_2_intel_me.bin\n...\n0010500 4dde 9bf2 bdc9 79b3 c237 266f 27e6 9038\n0010510 bb90 c196 249d 012b a19e e27c b042 3129\n0010520 8b65 b4dc a806 45a9 0cea 70b1 19d3 13d3\n0010530 faf6 9b87 4d63 f761 f7f7 f7f7 f7f7 f7f7\n0010540 f7f7 f7f7 f7f7 f7f7 f7f7 f7f7 fff6 ffff\n0010550 ffff ffff ffff ffff ffff ffff ffff ffff\n*\n0010c80 36ff 7fdf 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f\n0010c90 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f 7f7f\n*\n0010cc0 7f7f 7f7f 7f7f ff60 ffff ffff ffff ffff\n0010cd0 ffff ffff ffff ffff ffff ffff ffff ffff\n*\n0011160 7fff fe8c 5e5e d058 f80c 0cd0 d0f8 f80c\n0011170 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8\n0011180 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0\n0011190 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c\n00111a0 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8\n00111b0 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0\n00111c0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c\n00111d0 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8\n00111e0 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0\n00111f0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 d0f8 f80c\n0011200 0cd0 d0f8 f80c 0cd0 d0f8 f80c 0cd0 fff8\n0011210 ffff ffff ffff ffff ffff ffff ffff ffff\n*\n0015000\n```\n\n### Split X230 image\n\n```bash {1-2, 6}\n$ cd ./bin/x230_12mb/\n$ dd if=seagrub_x230_12mb_libgfxinit_corebootfb_ukqwerty.rom of=top.rom bs=1M skip=8\n4+0 records in\n4+0 records out\n4194304 bytes (4.2 MB, 4.0 MiB) copied, 0.0175795 s, 239 MB/s\n$ dd if=seagrub_x230_12mb_libgfxinit_corebootfb_ukqwerty.rom of=bottom.rom bs=1M count=8\n8+0 records in\n8+0 records out\n8388608 bytes (8.4 MB, 8.0 MiB) copied, 0.0340301 s, 247 MB/s\n```\n\n### Flashing\n\n#### Serprog\n\nYou can use a Raspberry Pi Pico to flash the bios, you can compile the image to flash to the pico with one of the following.\n\n```bash {1}\n$ ./mk -b pico-serprog\n```\n\n#### Flashprog\n\nLibreboot standardises on flashprog now, compile it with:\n\n```bash {1}\n$ ./mk -b flashprog\n```\n\n##### External Flashing\n\nConnecting the EEPROM to a Raspberry Pi for flashing is same the same way as [Backing up the stock BIOS](#backup-stock-bios).\n\nI had an error when erasing and writing the flash chip, however it managed to recover itself:\n\n```bash {1}\n$ flashrom -p linux_spi:dev=/dev/spidev0.0 -c MX25L6405 -w ./grub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\nflashrom unknown on Linux 6.1.0-rpi8-rpi-v8 (aarch64)\nflashrom is free software, get the source code at https://flashrom.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\nUsing default 2000kHz clock. Use 'spispeed' parameter to override.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on linux_spi.\n===\nThis flash part has status UNTESTED for operations: WP\nThe test status of this chip may have been updated in the latest development\nversion of flashrom. If you are running the latest development version,\nplease email a report to flashrom@flashrom.org if any of the above operations\nwork correctly for you with this flash chip. Please include the flashrom log\nfile for all operations you tested (see the man page for details), and mention\nwhich mainboard or programmer you tested in the subject line.\nThanks for your help!\nReading old flash chip contents... done.\nErasing and writing flash chip... FAILED at 0x00081000! Expected=0xff, Found=0xea, failed byte count from 0x00080000-0x0008ffff: 0xeee7\nERASE FAILED!\nReading current flash chip contents... done. Looking for another erase function.\nErase/write done.\nVerifying flash... VERIFIED.\n```\n\n##### Internal Flashing\n\nOnce Libreboot is installed, you can flash updates internally without having to take the machine apart again:\n\n```bash {1}\n$ sudo ./elf/flashprog/flashprog -p internal -c MX25L6405 -w ./bin/x220_8mb/seagrub_x220_8mb_libgfxinit_corebootfb_ukqwerty.rom\n[sudo] password for user:\nflashprog p1.1-72-ge86b2a0 on Linux 5.15.0-119-generic (x86_64)\nflashprog is free software, get the source code at https://flashprog.org\n\nUsing clock_gettime for delay loops (clk_id: 1, resolution: 1ns).\ncoreboot table found at 0x7fe68000.\nFound chipset \"Intel QM67\".\nEnabling flash write... SPI Configuration is locked down.\nOK.\nFound Macronix flash chip \"MX25L6405\" (8192 kB, SPI) on internal.\nReading old flash chip contents... done.\nErasing and writing flash chip... Erase/write done.\nVerifying flash... VERIFIED.\n```\n\n# Operating Systems\n\nA non-exhaustive list of operating systems that I have used on the laptop.\n\n## Chromium OS\n\n![Chromium OS running on the X220](/assets/blog/thinkpad/chromium-os.jpg)\n\nI compilled [Chromium OS](https://www.chromium.org/chromium-os/quick-start-guide/) and got it running on the laptop.\n\n![I compiled the OS myself from the original source code](/assets/blog/thinkpad/chromium-os-developer-build.jpg)\n\n## Linux From Scratch\n\n![Linux From Scratch running on the X220](/assets/blog/thinkpad/linux-from-scratch.jpg)\n\nI ran through the base [Linux from Scratch book](https://www.linuxfromscratch.org/lfs/view/stable/) and got a basic Linux os.\n\n## Mac OS\n\n![Mac OS running on the X220](/assets/blog/thinkpad/mac-os.jpg)\n\nThe laptop can run up to [Mac OS High Sierra](https://x220.mcdonnelltech.com/) as the Video card does not support Metal.\n\n## Ubuntu\n\n![Ubuntu running on the X220](/assets/blog/thinkpad/ubuntu.jpg)\n\nThe Main Operating system I use on the laptop\n\n## Windows 11\n\n![Windows 11 running on the X220](/assets/blog/thinkpad/windows-11.jpg)\n\nThe laptop does not officially support Windows 11 as it does not have Secure boot or a TPM 2.0, it only has a TPM 1.1.\n","lastmod":"2025-03-14T23:22:38.962Z"},"related":[{"slug":"thinkcenter","related":[],"external":[],"title":"Thinkcenter","heading":"","date":"","preview":"/assets/blog/thinkcenter/thinkcenter-hero.jpg","author":{"name":"","picture":""},"description":"","tags":[],"categories":[],"keywords":[],"promoted":false,"content":""}]},"__N_SSG":true}